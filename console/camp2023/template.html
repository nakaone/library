<!DOCTYPE html><html xml:lang="ja" lang="ja"><head>
  <title>校庭キャンプ2023</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <!-- UML: PlantUML
    参考：JavaScriptを用いてPlantUMLを呼び出す
    https://168iroha.net/blog/topic/?id=202206081036&sorting=post_date
  -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/plantuml-encoder@1.4.0/dist/plantuml-encoder.min.js"></script>

  <!-- MarkDownテキストをHTML化するCDN -->
  <script src="https://taisukef.github.io/marked_md/marked.min.js"></script>

  <style type="text/css">
    .img {
      width: 80%;
      overflow: scroll;
    }
    .PlantUML {
      overflow-x: auto;
    }
  </style>
</head>
<body class="TabMenu" name="main">

  <div class="TabMenu" name="お知らせ">
    <div name="掲示板">
      <button onclick="redraw()">更新</button>
      ※ 自動更新されません。また更新は3分程度の間隔をあけてください
      <div name="board"></div>
    </div>
    <div name="注意事項" class="markdown" data-embed="注意事項.md"></div>
    <div name="持ち物" class="markdown" data-embed="持ち物リスト.md"></div>
  </div>

  <!--div name="passport"><h1>パスポート</h1></div-->

  <div name="案内図"><div class="img" data-embed="map2023.svg"></div></div>

  <div class="TimeTable" name="予定表">
    <!--
    <ul>
      <li>図中の「▼」「▶️」をクリックすると下位項目が開閉されます</li>
      <li>作業項目名をクリックすると詳細が表の下に表示されます</li>
    </ul>
      詳細は別ページ？　別ペイン？
      表示範囲絞り込み
      所要物一覧
    -->
  </div>

  <div class="TabMenu" name="スタッフ">
    <div name="日程表">
      <div class="PlantUML"  data-embed="schedule.pu"><img /></div>
      <div class="markdown" name="schedule2"></div>
      <!--
        遊び場保険、スケジュールに追加
      -->
    </div>

    <!--div name="scanner"><h1>QRコード受付</h1></div-->

    <div name="校内探検">
      <img width="600px" data-embed='{"from":{"filename":"expedition.txt"},"to":"png"}' />
      <div class="markdown" data-embed="肝試し配置.md"></div>
    </div>

    <div name="参加者数集計">
      <h1>工事中</h1>
      <p>以下はMermaid出力テスト画面(完成時のイメージとは関係ありません)</p>
      <div name="test" class="mermaid">
        sequenceDiagram
          太郎->>花子: おはよう
          花子->>太郎: こんにちは！！
      </div>
    </div>

    <div class="TabMenu" name="論議メモ">
      <div class="markdown" name="6/10定例会" data-embed="20230610.md"></div>
      <div class="markdown" name="7/08定例会" data-embed="20230708.md"></div>
    </div>

    <div class="markdown" name="関連サイト" data-embed="RelatedSites.md"></div>

    <div class="TabMenu" name="参考資料">
      <div class="markdown" name="申込フォーム作成手順" data-embed="makeForm.md"></div>
    </div>
    
  </div>


<script src="https://cdn.jsdelivr.net/npm/mermaid@10.2.4/dist/mermaid.min.js"></script>

<!-- 自作ライブラリ -->
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/Array.tabulize.html","selector":"script.core"},"to":"js"}'></script>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/Date.toLocale.html","selector":"script.core"},"to":"js"}'></script>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/mergeDeeply.html","selector":"script.core"},"to":"js"}'></script>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/TabMenu.html","selector":"script.core"},"to":"js"}'></script>
<style type="text/css" data-embed='{"from":{"filename":"../../component/TimeTable.html","selector":"style.core"},"to":"css"}'></style>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/TimeTable.html","selector":"script.core"},"to":"js"}'></script>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/whichType.html","selector":"script.core"},"to":"js"}'></script>

<script type="text/javascript" class="main">
function redraw(){
  const url = {
    GAS:'https://script.google.com/macros/s/AKfycbxtxS_u1BVahosczLxtt9yFS8Lh97lXEj4t7xmzCp4v1qgDft4RaSZUrbv-cMR0k03I/exec',
    sheet: 'https://tinyurl.com/2ahyly3l',
  };

  fetch(url.GAS)
  .then(response => response.json()).then(r => {
    const v = {};

    // Google Spreadからデータを取得してタイムテーブル表示
    v.TimeTable = new TimeTable('div.TimeTable',r,{datatype:'sheet',dataSheet:url.sheet});

    // 掲示板の表示
    console.log(r.notice);
    v.notice = {
      raw: r.notice,
      element: document.querySelector('.TabMenu > [name="掲示板"] [name="board"]'),
      disp:[],
    }
    // rowデータをdipsとしてコピー
    v.notice.disp.push(['日時','メッセージ']); // ヘッダを変更
    for( v.i=1 ; v.i<v.notice.raw.length ; v.i++ ){
      v.r = v.notice.raw[v.i];
      if( v.r[0].length > 0 ){
        if( v.r[0] === '—' ){ // 時刻を表示しないメッセージ
          v.notice.disp.push(v.r);
        } else {  // 時刻の表示形式を変更
          v.notice.disp.push([new Date(v.r[0]).toLocale('M/dd hh:mm'),v.r[1]]);
        }
      }
    }
    v.notice.element.innerHTML = '';  // ボード領域をクリア
    v.notice.element.appendChild(v.notice.disp.tabulize());
    console.log(v);
  });

  // MarkDownで記述された部分をHTML化して表示
  document.querySelectorAll('div.markdown').forEach(x => {
    x.innerHTML = marked(x.innerHTML);
  });

  // PlantUMLで記述された部分をHTML化して表示
  document.querySelectorAll('div.PlantUML').forEach(x => {
    let src = x.querySelector('div').innerHTML;
    x.querySelector('img').src = "http://www.plantuml.com/plantuml/svg/"
      + plantumlEncoder.encode(src);
  });

  // Mermaidで記述された部分をHTML化して表示
  mermaid.initialize({startOnLoad: true});

}


// ブラウザ上で実行する場合の処理
window.addEventListener('DOMContentLoaded',() => {
  const v = {};
  // メニューを定義
  document.querySelectorAll('.TabMenu[name]').forEach(x => {
    v.menuName = x.getAttribute('name');
    v.arg = {name:v.menuName};
    console.log(v.menuName,v.arg);
    v[v.menuName] = new TabMenu(v.arg);
  });

  // 画面を描画
  redraw();
});
</script>
</body></html>