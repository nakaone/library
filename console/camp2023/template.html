<!DOCTYPE html><html xml:lang="ja" lang="ja"><head>
  <title>校庭キャンプ2023</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <!-- link rel="stylesheet" type="text/css" href="../../component/szLib.css" -->
  <style type="text/css" data-embed="../../component/szLib.css"></style>
  <style type="text/css" data-embed="../../component/loading.css"></style>

  <style type="text/css">
    .img {
      width: 100%;
      overflow: scroll;
    }
    .PlantUML {
      overflow-x: auto;
    }
    .BurgerMenu[name="main"] {
      margin-top: 1rem; /* 最上位メニューの上に余白設定 */
    }
    .BurgerMenu .page {
      padding: 1rem;
      width: calc(100% - 2rem);
      height: calc(100% - 2rem);
    }
    [data-BurgerMenu] {
      padding: 1rem;
      width: calc(100% - 2rem);
    }
  </style>
</head>
<body>
  <div name="loading"><div><div class="loading5">loading...</div></div></div>

  <div data-BurgerMenu="label:'お知らせ'">
    <div data-BurgerMenu="label:'掲示板'"></div>
    <div data-BurgerMenu="label:'注意事項'" class="markdown" data-embed="注意事項.md"></div>
    <div data-BurgerMenu="label:'持ち物'" class="markdown" data-embed="持ち物リスト.md"></div>
    <div data-BurgerMenu="label:'校内探険'">
      <img width="100%" data-embed='{"from":{"filename":"expedition.txt"},"to":"png"}' />
    </div>
  </div>
  <div data-BurgerMenu="label:'参加者パス'"></div>
  <div data-BurgerMenu="label:'案内図'">
    <img width="100%" data-embed='{"from":{"filename":"map2023.txt"},"to":"png"}' />
  </div>
  <div data-BurgerMenu="label:'予定表'"></div>
  <div data-BurgerMenu="label:'参加者アンケート',authority:1,href:'https://tinyurl.com/2bruynm8'"></div>
  <div data-BurgerMenu="label:'スタッフ',authority:2">
    <div data-BurgerMenu="label:'参加者数',func:'statistics'"></div>
    <div data-BurgerMenu="label:'受付業務',func:'recept'"></div>
    <!--div data-BurgerMenu="label:'校内探険'">
      <div class="page">
        <img width="600px" data-embed='{"from":{"filename":"expedition.txt"},"to":"png"}' />
        <div class="markdown" data-embed="肝試し配置.md"></div>
      </div>
    </div--><!-- 校内探険ここまで -->
    <!--div data-BurgerMenu="label:'参考資料'">
      <div data-BurgerMenu="label:'日程表'">
        <div class="PlantUML"  data-embed="schedule.pu"><img /></div>
        <div class="markdown" name="schedule2"></div>
      </div>
      <div data-BurgerMenu="label:'論議メモ'">
        <div data-BurgerMenu="label:'6/10定例会'" class="markdown" data-embed="20230610.md"></div>
        <div data-BurgerMenu="label:'7/08定例会'" class="markdown" data-embed="20230708.md"></div>
        <div data-BurgerMenu="label:'9/09定例会'" class="markdown" data-embed="20230909.md"></div>
      </div>
    </div>< 参考資料ここまで -->
    <div data-BurgerMenu="label:'関連サイト'">
      <div>
        <h3>おやじの会」メーリングリスト登録フォーム</h3>
        <p><a href="https://tinyurl.com/23hgkfv4" target="_blank">https://tinyurl.com/23hgkfv4</a></p>
        <img src="https://chart.apis.google.com/chart?cht=qr&chs=200x200&chl=https://tinyurl.com/23hgkfv4" />
      </div>
      <div>
        <h3>「校庭キャンプ2023」サイト</h3>
        <p><a href="https://tinyurl.com/2aeqv5f5" target="_blank">https://tinyurl.com/2aeqv5f5</a></p>
        <img src="https://chart.apis.google.com/chart?cht=qr&chs=200x200&chl=https://tinyurl.com/2aeqv5f5" />
      </div>
      <div>
        <h3>おやじの会LINEグループ</h3>
        <p><a href="https://line.me/R/ti/g/kCmlmtuXTd" target="_blank">https://line.me/R/ti/g/kCmlmtuXTd</a></p>
        <img src="https://chart.apis.google.com/chart?cht=qr&chs=200x200&chl=https://line.me/R/ti/g/kCmlmtuXTd" />
      </div>
      <div>
        <h3>お友達申請</h3>
        <p>上記LINEグループで「年齢確認が必要です」と言われた場合、以下で嶋津へのお友達申請を実施</p>
        <p><a href="https://line.me/ti/p/sETY5YmVFW" target="_blank">https://line.me/ti/p/sETY5YmVFW</a></p>
        <img src="https://chart.apis.google.com/chart?cht=qr&chs=200x200&chl=" />
      </div>
      <div>
        <h3>参加者アンケート</h3>
        <p><a href="https://tinyurl.com/2bruynm8" target="_blank">https://tinyurl.com/2bruynm8</a></p>
        <img src="https://chart.apis.google.com/chart?cht=qr&chs=200x200&chl=https://tinyurl.com/2bruynm8" />
      </div>
      <div>
        <h3>運営側の評価・反省点</h3>
        <p><a href="https://tinyurl.com/27fcxy3k" target="_blank">https://tinyurl.com/27fcxy3k</a></p>
        <img src="https://chart.apis.google.com/chart?cht=qr&chs=200x200&chl=https://tinyurl.com/27fcxy3k" />
      </div>
      <div>
        <h3>おまつり奉行(GitHub版)</h3>
        <p><a href="https://tinyurl.com/2cfoeobm" target="_blank">https://tinyurl.com/2cfoeobm</a></p>
        <img src="https://chart.apis.google.com/chart?cht=qr&chs=200x200&chl=https://nakaone.github.io/library/console/camp2023/camp2023.html" />
      </div>
    </div>
  </div>
  <div data-BurgerMenu="label:'システム設定'">
    <div>
      <h3>システムツール</h3>
      <button onclick="saveAuth()">認証を保存</button>
      <p>現在使用されている「おまつり奉行」関係の情報をlocalStorageに保存します。<br>
      保存することにより、リロードの都度必要になる認証を省略できます。<br>
      ※ localStorage: cookieのように、ユーザーのデータをWebブラウザ(ローカル環境)に保存することができる仕組み</p>
      <button onclick="clearAuth()">認証を消去</button>
      <p>localStorageに保存されている「おまつり奉行」関係の情報を全て消去します。
      </p>
    </div>
    <hr>
    <div>
      <h3>「おまつり奉行」について</h3>
      <p>OMATSURI Bugyo: JavaScript SPA to support event participants and stakeholders.</p>
      <ul>
        <li>Version.1.0.3 : 2023.09.29 release</li>
      </ul>
      <p>author: Shimazu Kunihiro</p>
      <p>contact: shimokitasho.oyaji@gmail.com</p>
    </div>
  </div>

</body>
<!-- =====================================================
  CDN
===================================================== -->
<!-- UML: PlantUML
  参考：JavaScriptを用いてPlantUMLを呼び出す
  https://168iroha.net/blog/topic/?id=202206081036&sorting=post_date
-->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/plantuml-encoder@1.4.0/dist/plantuml-encoder.min.js"></script>

<!-- MarkDownテキストをHTML化するCDN -->
<script src="https://taisukef.github.io/marked_md/marked.min.js"></script>

<!-- 共通鍵暗号化：cryptoJS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/enc-base64.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/cipher-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/sha256.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/sha1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/aes.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/hmac.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/pbkdf2.min.js"></script>
<!-- cryptico -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/cryptico/0.0.1343522940/cryptico.min.js" integrity="sha512-C7GGRhFRn7F7hsLH1oCH2kX9ls61kx33wAgTZ6xJDwGvvgULcIZpwKqxG1+Kj/KOD2jWPxjNQYHi4BopPJPxVA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<!-- mermaid -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10.2.4/dist/mermaid.min.js"></script>
<!-- QRコード検出/生成 -->
<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<!-- alaSQL -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/alasql/4.1.7/alasql.min.js" integrity="sha512-xdGKK8okKKREuKT6V7QYlXVJ+jIZQC9zOEGzeiF2tHOMXdMMXQESDXlpn8FDGKdIUOkJYI0IO3q6JoMWoR6XAg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<!-- =====================================================
  自作ライブラリ
===================================================== -->
<script type="text/javascript" data-embed='../../component/Auth/core.js'></script>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/Array.tabulize.html","selector":"script.core"},"to":"js"}'></script>
<script type="text/javascript" data-embed='../../component/BulletinBoard/core.js'></script>
<script type="text/javascript" data-embed='../../component/BurgerMenu/core.js'></script>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/createElement.html","selector":"script.core"},"to":"js"}'></script>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/createPassword.html","selector":"script.core"},"to":"js"}'></script>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/cryptoAES.html","selector":"script.core"},"to":"js"}'></script>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/Date.toLocale.html","selector":"script.core"},"to":"js"}'></script>
<script type="text/javascript" data-embed='../../component/Participants/core.js'></script>
<script type="text/javascript" data-embed='../../component/itemSelector/core.js'></script>
<script type="text/javascript" data-embed='../../component/LoadingIcon/core.js'></script>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/mergeDeeply.html","selector":"script.core"},"to":"js"}'></script>
<script type="text/javascript" data-embed='../../component/setupInstance/core.js'></script>
<script type="text/javascript" data-embed='../../component/Reception/core.js'></script>
<script type="text/javascript" data-embed='../../component/TimeTable/core.js'></script>
<!--style type="text/css" data-embed='{"from":{"filename":"../../component/TimeTable.html","selector":"style.core"},"to":"css"}'></style>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/TimeTable.html","selector":"script.core"},"to":"js"}'></script-->
<script type="text/javascript" data-embed='../../component/TNoParticipants/core.js'></script>
<script type="text/javascript" data-embed='../../component/WebScanner/core.js'></script>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/whichType.html","selector":"script.core"},"to":"js"}'></script>

<!--script type="text/javascript" data-embed="camp2023.Participants.js"></script -->

<script type="text/javascript" class="main">
let authString;
const saveAuth = () => {
  try {
    localStorage.removeItem('conf');
    localStorage.setItem('conf',authString);
    alert('「おまつり奉行」関係の情報を保存しました');
  } catch(e) {
    alert('Error: failed to save authString.\n' + e.message + '\n' + e.stack);
    console.error(e);
  }
}
const clearAuth = () => {
  try {
    localStorage.removeItem('conf');
    alert('「おまつり奉行」関係の情報を消去しました');
  } catch(e) {
    alert('Error: failed to clear authString.\n' + e.message + '\n' + e.stack);
    console.error(e);
  }
}
window.addEventListener('DOMContentLoaded',async () => {
  const v = {whois:'DOMContentLoaded',opt:{},
    // 認証局
    gwURL:'https://script.google.com/macros/s/AKfycbwSvy450w3Bu3GhbBlNFGS5bJAHWi91_gEC42tTtWScAkJUjdZ35SncfXi2slktGH9h/exec',
    // 資料集
    docURL:'https://script.google.com/macros/s/AKfycbxtxS_u1BVahosczLxtt9yFS8Lh97lXEj4t7xmzCp4v1qgDft4RaSZUrbv-cMR0k03I/exec',
    docSheet: 'https://tinyurl.com/2ahyly3l',
    searchParams: new URLSearchParams(window.location.search),
  };
  try {

    console.log(v.whois+' start.');

    // ================================================
    // 1. 利用する各種クラスのインスタンス化
    // ================================================

    // ----------------------------------------------------
    v.step = '1.1'; // Auth: 認証
    v.ls = localStorage.getItem('conf');
    v.flag = true;  // entryNo/passCode入力(Auth.build)が要実行ならtrue
    // 注：Authが旧版(2023.8.5版)のため、v.optにcreatedを設定してもconstructorで反映されない。
    // ただしv.optに設定する方が正しく、悪影響もないため、createdについては以下のように記述しておく
    if( v.ls !== null ){
      v.opt = JSON.parse(v.ls);
      // createdが未定義だった場合、大過去を設定してflag=trueにする
      v.opt.created = v.opt.created || 0;
      if((Date.now() - v.opt.created) < 172800000){
        // localStorageに存在し、かつ有効期限内
        // ⇒ Auth.build実行不要(falseにする)
        v.flag = false;
        // created(作成時刻)は更新しない
      } else {
        // localStorageに存在するが有効期限切れ
        // ⇒ Auth.build要実行(trueのままにする)
        v.n = v.opt.entryNo.value;
        v.opt = {
          created: Date.now(),  // 作成時刻を更新
          entryNo: {value:v.n}, // 受付番号は引き継ぐ
        }
      }
    } else {
      // localStorageに存在しない
      // ⇒ Auth.constructor+build両方実行
      v.opt.created = Date.now();
      // クエリ文字列で受付番号が与えられた場合、受付番号欄にセット
      if( v.searchParams.has('id') ){
        v.opt.entryNo = {value:String(v.searchParams.get('id'))};
      }
    }
    v.Auth = new Auth(v.gwURL,v.opt);
    if( v.Auth instanceof Error ) throw v.Auth;
    if( v.flag ) await v.Auth.build();
    v.a = JSON.parse(JSON.stringify(v.Auth));
    v.a.created = Date.now();
    authString = JSON.stringify(v.a);


    // ----------------------------------------------------
    v.step = '1.2'; // BulletinBoard: 掲示板
    v.BulletinBoard = new BulletinBoard(
      '[data-BurgerMenu="label:\'掲示板\'"]',
      v.Auth, // 認証局他のAuthインスタンス
    );
    if( v.BulletinBoard instanceof Error ) throw v.BulletinBoard;

    // ----------------------------------------------------
    v.step = '1.3'; // Participants: 参加者情報の表示
    v.Participants = new Participants(
      'div[data-BurgerMenu="label:\'参加者パス\'"]',
      v.Auth.info
    );
    if( v.Participants instanceof Error ) throw v.Participants;

    // ----------------------------------------------------
    v.step = '1.4'; // TimeTable: タイムテーブル
    v.TimeTable = new TimeTable('div[data-BurgerMenu="label:\'予定表\'"]',{
    base: '2023/9/30', // 基準日
    span: 10 * 60 * 1000, // 時刻目盛の最小単位。既定値は10分(ミリ秒表記)
    options: [  // ドロップダウンの選択肢(select内のoption)
      {label:'参加者',value:16},
      {label:'設営関係、他',value:1},
      {label:'受付関係',value:2},
      {label:'校内探検関係',value:4},
      {label:'カレー＋朝食関係',value:8},
      {label:'全項目表示',value:31},
    ],
    // 以降の開始/終了時刻表記は①上記span単位、②hh:mm形式、③日付を跨る場合、hhは+24H
    tasks: [
      {st:'8:30', ed:'08:40', label:'オリエンテーション', mode:15, PIC:'', note: `<ol>
        <li>各自の役割確認</li>
        <li>各作業開始時刻・集合場所の確認</li>
        <li>買出する材料・資材および担当の確認</li>
        <li>受付用小銭の両替</li>
      </ol>`,
      pending:[]},
      // 本部・設営班 (v.flag=1)
      {st:'08:40', ed:'09:00', label:'本部設営', mode:1, PIC:'', note:`<ol>
        <li>ランタンと電源準備</li>
        <li>受付は机2椅子4</li>
        <li>ウォーターサーバ設置、麦茶＋コップ(スタッフ用)を用意</li>
      </ol>`, pending:[]},
      {st:'09:00', ed:'09:20', label:'受付設営', mode:3, PIC:'',
        note: '受付は机2椅子4＋カラーコーン5,6個', pending:[]},
      {st:'09:20', ed:'10:00', label:'ブルーシート敷設、区画線引', mode:1, PIC:'', pending:[]},
      {st:'13:40', ed:'17:30', label:'参加者テント設営対応', mode:1, PIC:'', pending:[]},
      {st:'20:30', ed:'21:00', label:'就寝準備', mode:17, PIC:'', pending:[]},
      {st:'21:00', ed:'29:00', label:'夜間巡回', mode:1, PIC:'', pending:[]},
      {st:'32:00', ed:'34:00', label:'片付け(スタッフ)', mode:1, PIC:'', pending:[]},
      {st:'33:00', ed:'33:10', label:'閉会式', mode:17, PIC:'', pending:[]},

      // 受付班 (v.flag=2)
      {st:'09:20', ed:'09:40', label:'案内標識設置', mode:2, PIC:'',note:`<ol>
        <li>東門に「正門に回ってください」の標識</li>
        <li>正門に「参加者パスを表示してください」の標識</li>
      </ol>`, pending:[]},
      {st:'10:00', ed:'11:00', label:'予行演習', mode:2, PIC:'',note:[], pending:[]},
      {st:'13:30', ed:'16:00', label:'受付', mode:18, PIC:'嶋津＋2,3名',
        note: '<p>「受付開始以降、校庭遊び禁止」を注意書きに付記</p>'
        + '<p>「遊んだものは片付けよう」の注意書き(＋標識？)</p>', pending:[]},
      {st:'19:00', ed:'21:00', label:'お迎え対応', mode:2, PIC:'',
        note: 'お迎えの個別確認はしない(声かけのみ)', pending:[]},

      // 校内探検班 (v.flag=4)
      {st:'07:30', ed:'08:00', label:'機材搬入', mode:4, PIC:'', pending:[]},
      {st:'14:00', ed:'17:00', label:'校内探検準備', mode:4, PIC:'八木氏＋3,4名', pending:[]},
      {st:'17:00', ed:'17:30', label:'お化け集合、打ち合わせ', mode:4, PIC:'', pending:[]},
      {st:'18:30', ed:'20:30', label:'校内探検', mode:21, PIC:'', pending:[]},

      // カレー班 (v.flag=8)
      {st:'08:40', ed:'09:40', label:'灯油買い出し', mode:8, PIC:'岩佐氏', pending:[]},
      {st:'09:20', ed:'10:20', label:'カレー鍋設営', mode:8, PIC:'', pending:[]},
      {st:'09:30', ed:'11:00', label:'材料買い出し', mode:8, PIC:'',
        note: '買い出し用に飯田氏が車提供', pending:[]},
      {st:'13:00', ed:'17:30', label:'カレー準備', mode:8, PIC:'神内氏、鐘江氏、＋8名位', pending:[]},
      {st:'29:00', ed:'31:30', label:'朝食準備', mode:8, PIC:'',note:`<ol>
        <li>紙コップ・箸は各自準備だが、不足に備え多少購入しておく</li>
        <li>素麺つゆはおやじで準備</li>
      </ol>`, pending:[]},

      // 一般参加者 (v.flag=16)
      {st:'14:00', ed:'14:10', label:'開会式', mode:17, PIC:'会長、校長or副校長', pending:[]},
      {st:'13:40', ed:'17:30', label:'テント設営、自由行動(遊戯)', mode:16, PIC:'', pending:[]},
      {st:'17:30', ed:'18:30', label:'カレー配膳、夕食', mode:24, PIC:'', pending:[]},
      {st:'19:00', ed:'21:00', label:'日帰り組帰宅(要お迎え)', mode:16, PIC:'', pending:[]},

      {st:'21:00', ed:'30:30', label:'就寝', mode:16, PIC:''},
      {st:'30:30', ed:'31:00', label:'起床', mode:16, PIC:'', pending:[]},
      {st:'31:00', ed:'31:10', label:'ラジオ体操', mode:16, PIC:'', pending:[]},
      {st:'31:10', ed:'33:00', label:'参加者テント片付け', mode:16, PIC:'', pending:[]},
      {st:'31:30', ed:'32:00', label:'朝食', mode:16, PIC:'', pending:[]},
    ],
  });

    /*
    v.TimeTable = new TimeTable('div[data-BurgerMenu="label:\'予定表\'"]',{
      base: '2023/09/30 08:30', // 表示領域左端の時刻
      span: 10 * 60 * 1000, // 時刻目盛の最小単位。既定値は10分(ミリ秒表記)
      list: [
        {st:'08:30', ed:'09:00', label:'集合、オリエンテーション', tag:15, PIC:''},

        // 本部・設営班 (v.flag=1)
        {st:'09:00', ed:'09:20', label:'本部テント設営', tag:1, PIC:'', note:[
          'ランタンと電源準備',
          '受付は机2椅子4',
          'ウォーターサーバ設置、麦茶＋コップ(スタッフ用)を用意',
        ]},
        {st:'09:20', ed:'09:40', label:'受付テント設営', tag:3, PIC:'', note:[
          '受付は机2椅子4＋カラーコーン5,6個',
        ]},
        {st:'09:40', ed:'10:30', label:'ブルーシート敷設、区画線引', tag:1, PIC:''},
        {st:'13:40', ed:'17:30', label:'参加者テント設営対応', tag:1, PIC:''},
        {st:'20:30', ed:'21:00', label:'就寝準備', tag:17, PIC:''},
        {st:'21:00', ed:'29:00', label:'夜間巡回', tag:15, PIC:''},
        {st:'32:00', ed:'34:00', label:'片付け', tag:15, PIC:''},
        {st:'33:00', ed:'33:10', label:'閉会式', tag:16, PIC:''},

        // 受付班 (v.flag=2)
        {st:'09:40', ed:'10:00', label:'案内標識設置', tag:2, PIC:'',note:[
          '東門に「正門に回ってください」の標識',
        ]},
        {st:'10:00', ed:'11:00', label:'予行演習', tag:2, PIC:'',note:[]},
        {st:'13:30', ed:'16:00', label:'受付', tag:18, PIC:'嶋津＋2,3名',note:[
          '「受付開始以降、校庭遊び禁止」を注意書きに付記',
          '「遊んだものは片付けよう」の注意書き(＋標識？)',
        ]},
        {st:'19:00', ed:'21:00', label:'お迎え対応', tag:2, PIC:'',note:[
          'お迎えの個別確認はしない(声かけのみ)',
        ]},

        // 校内探検班 (v.flag=4)
        {st:'14:00', ed:'17:00', label:'校内探検準備', tag:4, PIC:'八木氏＋3,4名'},
        {st:'17:00', ed:'17:30', label:'お化け集合、打ち合わせ', tag:4, PIC:''},
        {st:'18:30', ed:'20:30', label:'校内探検', tag:21, PIC:''},

        // カレー班 (v.flag=8)
        {st:'09:00', ed:'09:30', label:'灯油買い出し', tag:8, PIC:'岩佐氏'},
        {st:'09:20', ed:'10:20', label:'カレー鍋設営', tag:8, PIC:'岩佐氏'},
        {st:'09:30', ed:'11:00', label:'材料買い出し', tag:8, PIC:'', note:[
          '買い出し用に飯田氏が車提供',
        ]},
        {st:'13:00', ed:'17:30', label:'カレー準備', tag:8, PIC:'神内氏、鐘江氏、＋8名位'},
        {st:'29:00', ed:'30:30', label:'朝食準備', tag:8, PIC:'',note:[
          '「紙コップ、箸の準備」を注意書きに付記',
          '紙コップ・箸は各自準備だが、不足に備え多少購入しておく',
          '素麺つゆはおやじで準備',
        ]},

        // 一般参加者 (v.flag=16)
        {st:'14:00', ed:'14:10', label:'開会式', tag:17, PIC:'会長、校長or副校長'},
        {st:'13:40', ed:'17:30', label:'テント設営、自由行動(遊戯)', tag:16, PIC:''},
        {st:'17:30', ed:'18:30', label:'カレー配膳、夕食', tag:24, PIC:''},
        {st:'19:00', ed:'21:00', label:'日帰り組帰宅(要お迎え)', tag:16, PIC:''},

        //{st:'21:00', ed:'30:30', label:'就寝', tag:16, PIC:''},
        {st:'30:30', ed:'31:00', label:'起床', tag:16, PIC:''},
        {st:'31:00', ed:'31:10', label:'ラジオ体操', tag:16, PIC:''},
        {st:'31:10', ed:'33:00', label:'片付け', tag:16, PIC:''},
        {st:'31:30', ed:'32:00', label:'朝食', tag:16, PIC:''},
      ],
    },{options: [
      {label:'参加者',value:16},
      {label:'設営関係',value:1},
      {label:'受付関係',value:2},
      {label:'校内探検関係',value:4},
      {label:'カレー関係',value:8},
    ]});
    */
    /*
    // データはGoogle Spreadから取得
    v.res = await fetch(v.docURL);
    v.res = await v.res.json();
    v.TimeTable = new TimeTable(
      'div.TimeTable',
      v.res,
      {datatype:'sheet',dataSheet:v.docSheet}
    );
    */
    if( v.TimeTable instanceof Error ) throw v.TimeTable;

    // ----------------------------------------------------
    v.step = '1.5'; // Reception: 参加者情報の検索・表示・編集(受付業務)
    v.Reception = new Reception(
      v.Auth, // 認証局他のAuthインスタンス
      '[data-BurgerMenu="label:\'受付業務\',func:\'recept\'"]', // parent
    );
    if( v.Reception instanceof Error ) throw v.Reception;

    // ----------------------------------------------------
    v.step = '1.6'; // TNoParticipants: 参加者数集計
    v.TNoParticipants = new TNoParticipants(
      'div[data-BurgerMenu="label:\'参加者数\',func:\'statistics\'"]',
      v.Auth
    );
    if( v.TNoParticipants instanceof Error ) throw v.TNoParticipants;

    // ----------------------------------------------------
    v.step = '1.7'; // BurgerMenu: ナビゲーションメニュー
    // 他インスタンスのメソッドをfuncとして使用するので最後に定義
    v.BurgerMenu = new BurgerMenu('body',{
      authority: v.Auth.info.authority,
      home: 'c1002',  // 掲示板画面をホームに設定(暫定)
      //home: 'c1005',  // 参加者パス画面をホームに設定(暫定)
      func: {
        recept: v.Reception.main,     // 受付業務
        statistics: v.TNoParticipants.build, // 参加者数集計
      },
    });
    if( v.BurgerMenu instanceof Error ) throw v.BurgerMenu;
    // メニュー遷移時、定期配信の停止を追加定義
    //v.BurgerMenu.onLeave.push(v.BulletinBoard.stop);
    // -> 止めるとdelivery自体止まってしまうので停止しない


    // ================================================
    // 2. 他言語記述部分のHTML化
    // ================================================

    v.step = '2.1'; // MarkDownで記述された部分をHTML化して表示
    document.querySelectorAll('div.markdown').forEach(x => {
      x.innerHTML = marked(x.innerHTML);
    });

    v.step = '2.2'; // PlantUMLで記述された部分をHTML化して表示
    document.querySelectorAll('div.PlantUML').forEach(x => {
      let src = x.querySelector('div').innerHTML;
      x.querySelector('img').src = "http://www.plantuml.com/plantuml/svg/"
        + plantumlEncoder.encode(src);
    });

    v.step = '2.3'; // Mermaidで記述された部分をHTML化して表示
    mermaid.initialize({startOnLoad: true});

    // ================================================
    // 3. 個別メニュー画面の作成・表示
    // ================================================

    v.step = '3.1'; // お知らせ
    v.step = '3.1.1'; // 掲示板
    v.rv = await v.BulletinBoard.receive();
    if( v.rv instanceof Error ) throw v.rv;
  
    // 3.1.2 注意事項
    // 3.1.3 持ち物

    v.step = '3.2'; // 参加者パス
    v.rv = v.Participants.view(v.Auth.info);
    if( v.rv instanceof Error ) throw v.rv;

    // 3.3 案内図
    // 3.4 予定表(TimeTable)
    // 3.5 スタッフ
    // 3.5.1 参加者数
    // 3.5.2 受付業務
    // 3.5.3 校内探険
    // 3.5.4 参考資料
    // 3.5.4.1 日程表
    // 3.5.4.2 論議メモ
    // 3.5.4.3 関連サイト
    // 3.6 システム設定

    // ================================================
    // 4. 権限による表示制御、終了処理
    // ================================================

    v.step = '4.1'; // 権限により表示画面制御
    // 最終段階以前で不要な要素を削除すると「要素が見つからない」エラーが発生
    // ⇒ 最終段階で実行する
    v.authority = Number(v.Auth.info.authority)
    if( (v.authority & 3) === 0 ){
      v.step = '4.1a'; // 1(参加者)、2(スタッフ)、3(管理者)いずれでもない
      alert('参加資格を確認してください');
      document.querySelectorAll('body > div').forEach(x => x.remove());
      return;
    } else {
      // ローディング画面解除
      document.querySelector('div[name="loading"]').style.display = 'none';
    } 

    v.step = '4.2'; // 終了処理
    v.BurgerMenu.change();  // ホーム画面を表示
    v.BulletinBoard.start(); // 掲示板定期受信を開始
    console.log(v.whois+' normal end.');

  } catch(e){
    const msg = v.whois+' abnormal end(step.'+v.step+').\n'
      + e.message + '\n' + e.stack;
    console.error(msg,e.stack,v);
    alert(msg);
  }
});
</script>
</html>