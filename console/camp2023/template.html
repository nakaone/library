<!DOCTYPE html><html xml:lang="ja" lang="ja"><head>
  <title>校庭キャンプ2023</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
    <!-- link rel="stylesheet" type="text/css" href="../../component/szLib.css" -->
  <style type="text/css" data-embed="../../component/szLib.css"></style>
  <style type="text/css" data-embed="../../component/loading.css"></style>

  <style type="text/css">
    .img {
      width: 100%;
      overflow: scroll;
    }
    .PlantUML {
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div name="loading"><div><div class="loading5">loading...</div></div></div>

  <div class="TabMenu" name="main">

    <div class="TabMenu" name="お知らせ">
      <div name="掲示板">
        <button onclick="redraw()">更新</button>
        ※ 自動更新されません。また更新は3分程度の間隔をあけてください
        <div name="board"></div>
      </div>
      <div name="注意事項" class="markdown" data-embed="注意事項.md"></div>
      <div name="持ち物" class="markdown" data-embed="持ち物リスト.md"></div>
    </div>

    <div name="パスポート"><div></div></div>

    <div name="案内図"><div class="img" data-embed="map2023.svg"></div></div>

    <div class="TimeTable" name="予定表">
      <!--
      <ul>
        <li>図中の「▼」「▶️」をクリックすると下位項目が開閉されます</li>
        <li>作業項目名をクリックすると詳細が表の下に表示されます</li>
      </ul>
        詳細は別ページ？　別ペイン？
        表示範囲絞り込み
        所要物一覧
        遊び場保険、スケジュールに追加
      -->
    </div>

    <div class="TabMenu" name="スタッフ">

      <div name="参加者数">
        <h1>工事中</h1>
        <p>以下はMermaid出力テスト画面(完成時のイメージとは関係ありません)</p>
        <div name="test" class="mermaid">
          sequenceDiagram
            太郎->>花子: おはよう
            花子->>太郎: こんにちは！！
        </div>
      </div>

      <div name="受付">
        <div class="webScanner"></div>
      </div>

      <div name="校内探検">
        <img width="600px" data-embed='{"from":{"filename":"expedition.txt"},"to":"png"}' />
        <div class="markdown" data-embed="肝試し配置.md"></div>
      </div>

      <div class="TabMenu" name="参考資料">

        <div name="日程表">
          <div class="PlantUML"  data-embed="schedule.pu"><img /></div>
          <div class="markdown" name="schedule2"></div>
        </div>
  
        <div class="TabMenu" name="論議メモ">
          <div class="markdown" name="6/10定例会" data-embed="20230610.md"></div>
          <div class="markdown" name="7/08定例会" data-embed="20230708.md"></div>
        </div>
  
        <div class="markdown" name="関連サイト" data-embed="RelatedSites.md"></div>

      </div>
    </div>

  </div>
</body>
<!-- =====================================================
  CDN
===================================================== -->
<!-- UML: PlantUML
  参考：JavaScriptを用いてPlantUMLを呼び出す
  https://168iroha.net/blog/topic/?id=202206081036&sorting=post_date
-->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/plantuml-encoder@1.4.0/dist/plantuml-encoder.min.js"></script>

<!-- MarkDownテキストをHTML化するCDN -->
<script src="https://taisukef.github.io/marked_md/marked.min.js"></script>

<!-- 共通鍵暗号化：cryptoJS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/enc-base64.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/cipher-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/sha256.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/sha1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/aes.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/hmac.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/pbkdf2.min.js"></script>

<!-- cryptico -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/cryptico/0.0.1343522940/cryptico.min.js" integrity="sha512-C7GGRhFRn7F7hsLH1oCH2kX9ls61kx33wAgTZ6xJDwGvvgULcIZpwKqxG1+Kj/KOD2jWPxjNQYHi4BopPJPxVA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdn.jsdelivr.net/npm/mermaid@10.2.4/dist/mermaid.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" integrity="sha512-CNgIRecGo7nphbeZ04Sc13ka07paqdeTu0WR1IM4kNcpmBAUSHSQX0FslNhTDadL4O5SAGapGt4FodqL8My0mA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<!-- =====================================================
  自作ライブラリ
===================================================== -->
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/Auth.html","selector":"script.core"},"to":"js"}'></script>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/Array.tabulize.html","selector":"script.core"},"to":"js"}'></script>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/createElement.html","selector":"script.core"},"to":"js"}'></script>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/createPassword.html","selector":"script.core"},"to":"js"}'></script>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/cryptoAES.html","selector":"script.core"},"to":"js"}'></script>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/Date.toLocale.html","selector":"script.core"},"to":"js"}'></script>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/mergeDeeply.html","selector":"script.core"},"to":"js"}'></script>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/TabMenu.html","selector":"script.core"},"to":"js"}'></script>
<style type="text/css" data-embed='{"from":{"filename":"../../component/TimeTable.html","selector":"style.core"},"to":"css"}'></style>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/TimeTable.html","selector":"script.core"},"to":"js"}'></script>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/webScanner.html","selector":"script.core"},"to":"js"}'></script>
<script type="text/javascript" data-embed='{"from":{"filename":"../../component/whichType.html","selector":"script.core"},"to":"js"}'></script>

<script type="text/javascript" class="main">
let config;
window.addEventListener('DOMContentLoaded',async () => {
  const v = {opt:{},debug:true,
    // 認証局
    gwURL:'https://script.google.com/macros/s/AKfycbwSvy450w3Bu3GhbBlNFGS5bJAHWi91_gEC42tTtWScAkJUjdZ35SncfXi2slktGH9h/exec',
    // 資料集
    docURL:'https://script.google.com/macros/s/AKfycbxtxS_u1BVahosczLxtt9yFS8Lh97lXEj4t7xmzCp4v1qgDft4RaSZUrbv-cMR0k03I/exec',
    docSheet: 'https://tinyurl.com/2ahyly3l',
  };
  console.log('DOMContentLoaded start.');

  v.step = '1'; // 認証
  v.ls = localStorage.getItem('conf');
  if( v.debug && v.ls !== null ){
    v.step = '1.1';
    // デバッグ用：リリース時はlocalStorage.setItemと併せて削除
    config = JSON.parse(v.ls);
    console.log(v.step+':',config);
  } else {
    v.step = '1.2';
    // クエリ文字列で受付番号が与えられた場合、受付番号欄にセット
    v.searchParams = new URLSearchParams(window.location.search);
    if( v.searchParams.has('id') ){
      v.opt.entryNo = {value:v.searchParams.get('id')};
    }
    config = new Auth(v.gwURL);
    await config.build();
    localStorage.setItem('conf',JSON.stringify(config));
    console.log(v.step+':',config);
  }

  v.step = '2'; // メニューを定義
  document.querySelectorAll('.TabMenu[name]').forEach(x => {
    v.menuName = x.getAttribute('name');
    v.arg = {name:v.menuName};
    console.log(v.menuName,v.arg);
    v[v.menuName] = new TabMenu(v.arg);
  });
  console.log(v.step+':',v);

  v.step = '3'; // MarkDownで記述された部分をHTML化して表示
  document.querySelectorAll('div.markdown').forEach(x => {
    x.innerHTML = marked(x.innerHTML);
  });

  v.step = '4'; // PlantUMLで記述された部分をHTML化して表示
  document.querySelectorAll('div.PlantUML').forEach(x => {
    let src = x.querySelector('div').innerHTML;
    x.querySelector('img').src = "http://www.plantuml.com/plantuml/svg/"
      + plantumlEncoder.encode(src);
  });

  v.step = '5'; // Mermaidで記述された部分をHTML化して表示
  mermaid.initialize({startOnLoad: true});

  v.step = '6'; // パスポートの内容描画
  const passportDiv = document.querySelector('div[name="パスポート"] div');
  v.entryNo = ('000'+config.entryNo.value).slice(-4);
  passportDiv.appendChild(createElement({
    tag:'p',
    text:'No.'+v.entryNo,
    style: {margin:"1rem 0",fontSize:"2rem"}
  }));
  qrcodeDiv = document.createElement('div');
  const qr = new QRCode(qrcodeDiv,{
    text: v.entryNo,
    width: 400,
    height: 400,
    colorDark: "#000",
    colorLight: "#fff",
    correctLevel : QRCode.CorrectLevel.H,
  });
  passportDiv.appendChild(qrcodeDiv);

  v.step = '7'; // Google Spreadからデータを取得してタイムテーブル表示
  v.res = await fetch(v.docURL);
  v.res = await v.res.json();
  v.TimeTable = new TimeTable('div.TimeTable',v.res,{datatype:'sheet',dataSheet:v.docSheet});

  v.ws = new webScanner('div[name="受付"] div.webScanner');
  v.ws.scanQR(r=>console.log('scanned QR Code = '+r)); 

  v.step = '8'; // 最終処理：ローディング画面解除
  document.querySelector('div[name="loading"]').style.display = 'none';

  console.log('DOMContentLoaded end.');
});
</script>
</html>