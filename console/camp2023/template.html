<!DOCTYPE html><html xml:lang="ja" lang="ja"><head>
  <title>校庭キャンプ2023</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <!-- UML: PlantUML
    参考：JavaScriptを用いてPlantUMLを呼び出す
    https://168iroha.net/blog/topic/?id=202206081036&sorting=post_date
  -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/plantuml-encoder@1.4.0/dist/plantuml-encoder.min.js"></script>

  <!-- MarkDownテキストをHTML化するCDN -->
  <script src="https://taisukef.github.io/marked_md/marked.min.js"></script>

  <!-- TabDesign用CSS -->
  <style type="text/css" data-embed=""></style>
</head>
<body class="TabDesign" name="main">
  <div class="tabs">
    <div name="schedule">schedule</div>
    <div name="timetable">time table</div>
    <div name="map">map</div>
    <div name="expedition">expedition</div>
    <div name="RelatedSites">Related Sites</div>
    <div name="minutes">minutes</div>
  </div>


  <div name="schedule"><h1>スケジュール</h1>
    <div class="image"><div class="wrapPlantUML"><img class="PlantUML" name="schedule1"></img></div></div>
    <div class="markdown" name="schedule2"></div>
  </div>

  <div name="timetable"><h1>タイムテーブル</h1>
    <ul>
      <li>図中の「▼」「▶️」をクリックすると下位項目が開閉されます</li>
      <li>作業項目名をクリックすると詳細が表の下に表示されます</li>
    </ul>
    <div class="timetable" name="tt01" data-embed="">
    </div>
  </div>

  <div name="map"><h1>マップ</h1>
    <div class="TabDesign" name="map">
      <div class="tabs">
        <div name="test01">test01</div>
        <div name="test02">test02</div>
      </div>
      <div name="test01"><h1>test01</h1></div>
      <div name="test02"><h1>test02</h1></div>
    </div>
    <img width="60%" data-embed="" />
  </div>

  <div name="expedition"><h1>肝試し</h1>
    <img width="80%" data-embed="" />
    <div class="markdown" name="kimodameshi"></div>
  </div>

  <div name="RelatedSites"><h1>関連サイト</h1>
    <div class="markdown" name="RelatedSites" data-embed=""></div>
  </div>

  <div name="minutes"><h1>参考：論議メモ</h1>
    <details><summary>2023/06/10 定例会</summary>
      <div class="markdown" name="20230610" data-embed=""></div>
    </details>
    <details><summary>2023/07/08 定例会</summary>
      <div class="markdown" name="20230708" data-embed=""></div>
    </details>
  </div>

<script data-embed="szLib.js"></script>

<script type="text/javascript" class="main">
function mergeDeeply(target, source, opts) {
  const isObject = obj => obj && typeof obj === 'object' && !Array.isArray(obj);
  const isConcatArray = opts && opts.concatArray;
  let result = Object.assign({}, target);
  if (isObject(target) && isObject(source)) {
    for (const [sourceKey, sourceValue] of Object.entries(source)) {
      const targetValue = target[sourceKey];
      if (isConcatArray && Array.isArray(sourceValue) && Array.isArray(targetValue)) {
        result[sourceKey] = targetValue.concat(...sourceValue);
      }
      else if (isObject(sourceValue) && target.hasOwnProperty(sourceKey)) {
        result[sourceKey] = mergeDeeply(targetValue, sourceValue, opts);
      }
      else {
        Object.assign(result, {[sourceKey]: sourceValue});
      }
    }
  }
  return result;
}

/**
 * @classdesc タブ切り替えのHTMLページを作成する
 */

class TabDesign {

  /**
   * @constructor
   * @param {string} [opt={}] - オプション
   * @returns {void}
   */
  constructor(opt={}){
    console.log('TabDesign.constructor start.');
    const v = {};
    this.option = mergeDeeply({
      name: null, // 対象となるページ全体のname属性。nullなら単一で特定不要と解釈
      initial: null,  // 初期表示ページの名前
      direction: 'x', // タブを並べる方向。x:横並び, y:縦並び
      style: {
        tabs: {
          selector: ".TabDesign .tabs",
          css: {
            width: "100%",
            height: "100%",
            margin: "0px",
            padding: "0px",
            boxSizing: "border-box",
            display: "grid",
          },
        },
        tab: {
          selector: ".TabDesign .tabs div",
          css: {
            paddingLeft: "1rem",
            borderBottom: "solid 4px #ccc",
          },
        },
        act: {
          //selector: ".TabDesign .tabs div.act",
          css: {
            paddingLeft: "1rem",
            borderBottom: "solid 4px #000",
          },
        }
      },
    },opt);
    //console.log(this.option);

    // 全体の親要素をthis.wrapper、タブ表示領域をthis.tabsに保存
    this.wrapperSelector = '.TabDesign'
      +( this.option.name === null ? '' : '[name="' + this.option.name + '"]');
    this.wrapper = document.querySelector(this.wrapperSelector);
    this.tabs = document.querySelector(this.wrapperSelector+' > .tabs');
    //console.log(this.wrapper);

    // スタイルの適用
    for( v.x of ['tabs','tab'] ){ // actは不要
      document.querySelectorAll(this.option.style[v.x].selector).forEach(element => {
        for( v.y in this.option.style[v.x].css ){
          element.style[v.y] = this.option.style[v.x].css[v.y];
        }
      });
    }

    // ページ名のリストを作成
    this.pageList = [];
    this.tabs.querySelectorAll('[name]')
    .forEach(x => this.pageList.push(x.getAttribute('name')));
    //console.log(this.pageList);

    // 各タブ・ページの要素をthis.tab/pageに保存
    this.tab = {};
    this.page = {};
    this.tabNum = 0;
    this.pageList.forEach(x => {
      this.tab[x] = this.wrapper.querySelector('.tabs [name="'+x+'"]');
      // ページは「TabDesignクラス直下のDIV」に限定
      this.page[x] = this.wrapper.querySelector('.TabDesign > div[name="'+x+'"]');
      //console.log(x,this.tab[x],this.page[x]);
      this.tab[x].addEventListener('click',()=>this.changePage(x));
      this.tabNum++;
    });
    // タブの数をタブ領域に設定
    this.tabs.style.gridTemplateColumns = 'repeat('+this.tabNum+',1fr)';

    this.changePage(this.option.initial); // 初期ページ
    console.log('TabDesign.constructor end.');
  }

  changePage(page=null){
    console.log('TabDesign.changePage start.');
    this.activePage = page === null ? this.pageList[0] : page;
    console.log(this.activePage,this.pageList,this.tab)
    this.pageList.forEach(x => {
      if( x === this.activePage ){
        console.log('activate:',this.tab[x]);
        //this.tab[x].classList.add('act');
        for( let y in this.option.style.act.css ){
          this.tab[x].style[y] = this.option.style.act.css[y];
        }
        this.page[x].style.display = '';
      } else {
        console.log('in-activate:',this.tab[x]);
        //this.tab[x].classList.remove('act');
        for( let y in this.option.style.tab.css ){
          this.tab[x].style[y] = this.option.style.tab.css[y];
        }
        this.page[x].style.display = 'none';
      }
    })
    console.log('TabDesign.changePage end.');
  }
}

// ブラウザ上で実行する場合の処理
window.addEventListener('DOMContentLoaded',() => {
  const v = {};
  //console.log('timetable test start.');

  v.main = new TabDesign({name:"main"});
  v.map = new TabDesign({name:"map"});

  /*
  const url = {
    GAS:'https://script.google.com/macros/s/AKfycbwm3R0FbnhGALwO1J8G0yxNBvGAL6kPKewyypoz3OFIwIaB56D9XKAjkbopwpOEYdFm/exec',
    sheet: 'https://tinyurl.com/2ahyly3l',
  }
  fetch(url.GAS)
  .then(response => response.json()).then(r => {
    const v = {raw:r,docs:{}};

    // タイムテーブルの表示
    const tt01 = new TimeTable('div.timetable[name="tt01"]',v.raw,{datatype:'sheet',dataSheet:url.sheet});

    // docsのオブジェクト化
    for( v.i=1 ; v.i<v.raw.docs.length ; v.i++ ){
      v.l = v.raw.docs[v.i];
      if( !(v.l[1] in v.docs) ) v.docs[v.l[1]] = {};  // type不存在
      v.docs[v.l[1]][v.l[2]] = v.l[3];
    }
    console.log(v.docs);

    // MarkDownで記述された部分をHTML化して表示
    console.log(document.querySelectorAll('div.markdown'));
    document.querySelectorAll('div.markdown').forEach(x => {
      //console.log(v.docs.markdown[x.getAttribute('name')])
      x.innerHTML = marked(v.docs.markdown[x.getAttribute('name')]);
    });

    // PlantUMLで記述された部分をHTML化して表示
    document.querySelectorAll('img.PlantUML').forEach(x => {
      //console.log(v.docs.PlantUML[x.getAttribute('name')])
      x.src = "http://www.plantuml.com/plantuml/svg/"+plantumlEncoder.encode(v.docs.PlantUML[x.getAttribute('name')]);
    });
  });
  */
});
</script>
</body></html>