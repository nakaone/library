<!DOCTYPE html><html xml:lang="ja" lang="ja"><head>
  <title>scanQR</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <style type="text/css">
    /* スマホ用に縦方向も最大領域を設定 */
    html {height: 100%;font-size: 100%;}
    body {height: 100%;}
    input {
      margin: 1rem;
      font-size:3rem;
    }
    #qrcode {
      margin: 1rem;
    }
    #result {
      margin: 1rem;
      font-size:2rem;
      overflow-wrap: anywhere;
      padding: 1rem;
    }
  </style>
</head>
<body>
  <div id="webScanner"></div>
  <input type="text" onchange="genQR()" />
  <div id="qrcode"></div>
  <a target="_blank"></a>
</body>
<!-- =====================================================
  CDN
===================================================== -->
<!-- QRコード検出 -->
<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
<!-- QRコード生成 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<!-- =====================================================
  自作ライブラリ
===================================================== -->
<script src="core.js"></script>
<script src="../../component/createElement.js"></script>
<script src="../../component/mergeDeeply.js"></script>
<script src="../../component/whichType.js"></script>

<!-- =====================================================
  主処理
===================================================== -->
<script type="text/javascript" class="main">
function genQR(){
  const v = {whois:'genQR',rv:null};
  try {
    console.log(v.whois+' start.');
    v.text = document.querySelector('input').value;

    // QRコードの作成
    v.qr = document.querySelector('#qrcode');
    v.qr.innerHTML = '';
    v.rv = new QRCode(v.qr,{
			text: v.text,
			width: 300, height: 300,
			colorDark: "#000000",
			colorLight: "#ffffff",
			correctLevel: QRCode.CorrectLevel.H
    });

    // リンクの更新
    v.a = document.querySelector('a');
    v.a.setAttribute('href',v.text);
    v.a.innerText = v.text;

    console.log(v.whois+' normal end.',v.rv);
  } catch(e){
    console.error(v.whois+' abnormal end.',e,v);
    return e;
  }
}

window.addEventListener('DOMContentLoaded',async () => {
  const v = {};
  console.log('DOMContentLoaded start.');

  const rv = await scanQR('#webScanner');
  console.log(rv);
  document.querySelector('input').value = rv;

  genQR();

  console.log('DOMContentLoaded end.');
});
</script>
</html>