<!DOCTYPE html><html xml:lang="ja" lang="ja"><head>
<title>design(drawPassport)</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link href="../szLib.css" rel="stylesheet" />
<style type="text/css">
  .drawPassport {
    width: calc(100% - 2rem);
    display: grid;
    grid-template-columns: 1fr;
    padding: 1rem;
    font-size: 1rem;
  }
  .drawPassport > div {
    width: 100%;
    margin: 1rem 0px;
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 1rem;
  }
  .drawPassport rt {
    font-size: 50%;
  }

  /* QRコード、受付番号、申込者名 */
  /*
  .drawPassport .summary {
    grid-template-rows: 2fr 3fr;
  }
  */
  .drawPassport .summary div {
    background-color: pink;
  }
  .drawPassport .summary [name="qrcode"]{
    padding: 0rem;
    grid-row: 1 / 3;
    grid-column: 1 / 5;
  }
  .drawPassport .summary [name="entryNo"]{
    grid-row: 1 / 2;
    grid-column: 5 / 13;
  }
  .drawPassport .summary [name="entryNo"] span {
    font-size: 2rem;
  }
  .drawPassport .summary [name="申込者氏名"]{
    grid-row: 2 / 3;
    grid-column: 5 / 13;
  }
  .drawPassport .summary ruby span {
    font-size: 2rem;
  }
  .drawPassport .summary rt span {
    font-size: 1rem;
  }

  /* ボタン領域 */
  .drawPassport .buttons {
    grid-template-columns: repeat(3, 1fr);
    gap: 2rem;
  }

  /* 参加者リスト */
  .drawPassport .list {
    gap: 0.2rem;
  }
  .drawPassport .list div:nth-child(4n+1) {
    grid-column: 1 / 3;
  }
  .drawPassport .list div:nth-child(4n+2) {
    grid-column: 3 / 7;
  }
  .drawPassport .list div:nth-child(4n+3) {
    grid-column: 7 / 10;
  }
  .drawPassport .list div:nth-child(4n+4) {
    grid-column: 10 / 13;
  }

  /* 詳細 */
  .drawPassport .detail {
    grid-template-columns: 2fr 3fr;
    gap: 0.2rem;
  }
</style>
</head><body>
  <div class="drawPassport">

    <div class="summary">
      <div name="qrcode"></div>
      <div name="entryNo">No.<span class="v"></span></div>
      <div name="申込者氏名"><ruby><span class="v"></span>
        <rt name="申込者カナ"><span class="v"></span></rt>
      </ruby></div>  
    </div>

    <div class="buttons">
      <button name="取消">取消</button>
      <button name="決定">決定</button>
      <button name="詳細">詳細</button>  
    </div>

    <div class="list">
      <div class="th">No</div>
      <div class="th">氏名</div>
      <div class="th">所属</div>
      <div class="th">参加費</div>
    </div>

    <div class="detail"></div>
  </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script type="text/javascript" src="../createElement.js"></script>
<script type="text/javascript" src="../mergeDeeply.js"></script>
<script type="text/javascript">
/*
- [JavaScriptでの rem ⇔ px に変換するテクニック＆コード例](https://pisuke-code.com/javascript-convert-rem-to-px/)
*/
window.addEventListener('DOMContentLoaded',() => {
  const v = {
    wrapper: document.querySelector('div.drawPassport'),
    calcSize:(n) => { // 画面のfr数(n)からサイズ(px)を計算
      v.fontSize = getComputedStyle(document.documentElement).fontSize;
      v.remSize = parseFloat(v.fontSize); // 1remのサイズ(px)
      v.gapSize = 0.5 * v.remSize;  // gridのgapのサイズ(px。CSS参照)
      v.frNum = 12; // 画面の横幅分割数(fr。CSS参照)
      v.cWidth = v.wrapper.clientWidth - 2 * v.remSize;
      // 親画面サイズ(px) - 2rem(padding)
      v.frSize = (v.cWidth - (v.frNum - 1) * v.gapSize) / v.frNum;
      return v.frSize * n + v.gapSize * (n-1);
    },
  };
  try {

    // QRコード、受付番号、申込者名
    config.entryStr = String('0000'+config.entryNo).slice(-4);
    v.qrSize = v.calcSize(4);
    console.log(v);
    new QRCode(v.wrapper.querySelector('[name="qrcode"]'),{
      text: config.entryStr,
      width: v.qrSize,
      height: v.qrSize,
      colorDark: "#000",
      colorLight: "#fff",
      correctLevel : QRCode.CorrectLevel.H,
    });

    ['entryNo','申込者氏名','申込者カナ'].forEach(x => {
      v.x = x;
      v.element = v.wrapper.querySelector('[name="'+x+'"] .v');
      v.element.innerText = config[v.x];
    });

    // ボタン領域
    // 参加者リスト
    v.list = v.wrapper.querySelector('div.list');
    for( v.i=1 ; v.i<6 ; v.i++ ){
      v.prefix = '参加者0' + v.i;
      if( config[v.prefix+'氏名'].length === 0 )
        continue;
      v.list.appendChild(createElement({
        attr: {class:'td'},
        style: {textAlign:'right'},
        text: v.i,
      }));
      v.list.appendChild(createElement(
        {attr: {class:'td'},children:[
          {tag:'ruby',text:config[v.prefix+'氏名'],children:[
            {tag:'rt',text:config[v.prefix+'カナ']}
      ]}]}));
      v.list.appendChild(createElement({
        attr: {class:'td'},
        text: config[v.prefix+'所属'],
      }));
      v.list.appendChild(createElement({
        attr: {class:'td'},
        text: config['fee0'+v.i],
      }));
    }

    // 詳細
    v.detail = v.wrapper.querySelector('div.detail');
    ["メールアドレス","申込者の参加","宿泊、テント","引取者氏名","緊急連絡先",
    "ボランティア募集","キャンセル","備考"].forEach(x => {
      v.detail.appendChild(createElement({
        attr: {class:'th'},
        text: x,
      }));
      v.detail.appendChild(createElement({
        attr: {class:'td'},
        text: config[x],
      }));
    });
    // 編集用URL
    v.detail.appendChild(createElement({
      attr: {class:'th'},
      text:'申込内容修正',
    }));
    v.detail.appendChild(createElement({
      tag:'button',
      text: '申込フォームを開く',
      event: {'click':()=>window.open(config.editURL,'_blank')},
    }));

  } catch(e){
    console.error(e,v);
  }
});

const config = {"タイムスタンプ":"2023-08-01T06:36:48.485Z","メールアドレス":"nakaone.kunihiro@gmail.com","申込者氏名":"国生　さゆり","申込者カナ":"コクショウ　サユリ","申込者の参加":"参加予定(宿泊あり)","宿泊、テント":"宿泊する(テントなし)","引取者氏名":"申込者が参加して帰宅時の付添もするのでお迎えは不要","参加者01氏名":"国生　二郎","参加者01カナ":"コクショウ　ジロウ","参加者01所属":"未就学児","参加者02氏名":"","参加者02カナ":"","参加者02所属":"","参加者03氏名":"","参加者03カナ":"","参加者03所属":"","参加者04氏名":"","参加者04カナ":"","参加者04所属":"","参加者05カナ":"","参加者05氏名":"","参加者05所属":"","緊急連絡先":"","ボランティア募集":"","備考":"","キャンセル":"","":"","name":"","entryStr":"","authority":"2","cancel":"","entryNo":"8","publicKey":"iPUMOS7fuuwQngJys2i1C+5D6bvmjrW82a0PXfyGYAyCyrlqSv8LXQdlHqwQeyrwoOv41SOaAVmLKFIFNpBBjmplfFFIxg4f6GAiVikHCMigqmCg+0XvHUEsQMSO5VHze9Sd1Tml/kcmpUEPg8zsIVSK6oFKQWLe69VFKMKt7T8=","editURL":"https://docs.google.com/forms/d/e/1FAIpQLScEzS8-uNgeM40rZvGl60uZewwHZhyPeQJAicS_LjMEYrMqfQ/viewform?edit2=2_ABaOnueEf0MZp9TyeRuVRGK6toYaRDxYmY5_-w_psQH_VRBlAkAfIB2h8Kay9qRUUITM98E","passCode":"868670","genPassCode":"2023-08-25T04:43:06.611Z","NG1":"","NG2":"","certificate":"2023-08-25T04:43:33.237Z","fee00":"","fee01":"","fee02":"","fee03":"","fee04":"","fee05":"","memo":""};
</script>
</html>