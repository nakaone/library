<?xml version="1.0"?>
<opml version="2.0">
  <head>
    <ownerEmail>
      ena.kaon@gmail.com
    </ownerEmail>
  </head>
  <body>
    <outline text="SpreadDb 1.2.0(d4369fcf4044)">
      <outline text="概要(3eca2504fb57)">
        <outline text="手順" _note="![](doc/flowchart.main.webp)">
          <outline text="スプレッドシートを凍結" />
          <outline text="queryで渡された操作要求を順次処理" />
          <outline text="権限確認後、command系内部関数の呼び出し" />
          <outline text="結果を実行結果オブジェクトに保存" />
          <outline text="実行結果オブジェクトの配列を変更履歴シートに追記" />
          <outline text="スプレッドシートの凍結解除" />
        </outline>
      </outline>
      <outline text="引数">
        <outline text="query {&lt;a href=&quot;https://workflowy.com/#/1e80990a7c63&quot;&gt;sdbQuery&lt;/a&gt;[]} 操作要求、またはその配列" />
        <outline text="opt {&lt;a href=&quot;https://workflowy.com/#/a4a26014ccb3&quot;&gt;sdbOption&lt;/a&gt;}={} 起動時オプション" />
      </outline>
      <outline text="戻り値 {&lt;a href=&quot;https://workflowy.com/#/b03c5ccd2f8f&quot;&gt;sdbMain&lt;/a&gt;}" />
      <outline text="使用例(6f8d7dc5cd54)" />
      <outline text="内部関数 - 非command系(a9f01a749b53)">
        <outline text="genTable() : sdbTableオブジェクトを生成(f783913fe275)">
          <outline text="引数">
            <outline text="arg {Object}">
              <outline text="name {string} - テーブル名" />
              <outline text="[cols] {&lt;a href=&quot;https://workflowy.com/#/df5b3c98954e&quot;&gt;sdbColumn&lt;/a&gt;[]} - 新規作成シートの項目定義オブジェクトの配列" />
              <outline text="[values] {Object[]|Array[]} - 新規作成シートに書き込む初期値" _note="行オブジェクトの配列、またはシートイメージ(プリミティブ型二次元配列)&#10;" />
            </outline>
            <outline text="1 Backlink">
              <outline text="引数 : &lt;a href=&quot;https://workflowy.com/#/ea8faab5f9f2&quot;&gt;genTable()の引数&lt;/a&gt;と同じ" />
            </outline>
          </outline>
          <outline text="戻り値 {&lt;a href=&quot;https://workflowy.com/#/976403e08f0e&quot;&gt;sdbTable&lt;/a&gt;}" />
        </outline>
        <outline text="genSchema() : sdbSchemaオブジェクトを生成(74c07b6144cd)">
          <outline text="引数">
            <outline text="arg {Object}">
              <outline text="cols {&lt;a href=&quot;https://workflowy.com/#/df5b3c98954e&quot;&gt;sdbColumn&lt;/a&gt;[]} - 項目定義オブジェクトの配列" />
              <outline text="header {string[]} - ヘッダ行のシートイメージ(=項目名一覧)" />
              <outline text="notes {string[]} - 項目定義メモの配列" />
              <outline text="values {Object[]} - 初期データとなる行オブジェクトの配列" />
            </outline>
          </outline>
          <outline text="戻り値 {&lt;a href=&quot;https://workflowy.com/#/2609271977a8&quot;&gt;sdbGenSchema&lt;/a&gt;}" />
        </outline>
        <outline text="genColumn() : sdbColumnオブジェクトを生成(a8e56dd4e3c7)">
          <outline text="引数">
            <outline text="arg {string|&lt;a href=&quot;https://workflowy.com/#/df5b3c98954e&quot;&gt;sdbColumn&lt;/a&gt;} シート上のメモの文字列またはsdbColumn" />
          </outline>
          <outline text="戻り値 {Object}">
            <outline text="column {&lt;a href=&quot;https://workflowy.com/#/df5b3c98954e&quot;&gt;sdbColumn&lt;/a&gt;} 項目の定義情報" />
            <outline text="note {string} シート上のメモの文字列" />
          </outline>
        </outline>
        <outline text="genLog() : sdbLogオブジェクトを生成(6fb9aba6d9f9)">
          <outline text="引数">
            <outline text="arg {Object.&amp;lt;string,any&amp;gt;} &lt;a href=&quot;https://workflowy.com/#/dab8cfcec9d8&quot;&gt;sdbLog&lt;/a&gt;に個別設定するメンバ名と値" />
          </outline>
          <outline text="戻り値 {&lt;a href=&quot;https://workflowy.com/#/dab8cfcec9d8&quot;&gt;sdbLog&lt;/a&gt;}" />
        </outline>
        <outline text="convertRow() : シートイメージと行オブジェクトの相互変換(e65032ddce65)">
          <outline text="引数">
            <outline text="data {any[][]|Object[]} 行データ。シートイメージか行オブジェクトの配列" />
            <outline text="[header] {string[]}=[] - ヘッダ行。rowが行オブジェクトで項目の並びを指定したい場合に使用" />
          </outline>
          <outline text="戻り値 {&lt;a href=&quot;https://workflowy.com/#/01ee6b06c8a6&quot;&gt;sdbConvertRow&lt;/a&gt;}" />
        </outline>
        <outline text="functionalize() : オブジェクト・文字列を基にObject/stringを関数化(6d09e5d0363d)">
          <outline text="引数">
            <outline text="arg">
              <outline text="table {&lt;a href=&quot;https://workflowy.com/#/976403e08f0e&quot;&gt;sdbTable&lt;/a&gt;} 呼出元で処理対象としているテーブル" />
              <outline text="data {Object|function|string} 関数化するオブジェクトor文字列" _note="引数のデータ型により以下のように処理分岐&#10;&#10;- Object ⇒ {キー項目名:キー項目の値}形式で、key:valueに該当するレコードを更新&#10;- Function ⇒ 行オブジェクトを引数に対象ならtrueを返す関数で、trueが返されたレコードを更新&#10;- string&#10;  - 無名関数またはアロー関数のソース文字列 ⇒ new Functionで関数化&#10;  - その他 ⇒ 項目定義で&quot;primaryKey&quot;を指定した項目の値&#10;" />
            </outline>
          </outline>
          <outline text="戻り値 {function}" />
        </outline>
      </outline>
      <outline text="内部関数 - command系(250e0f646160)">
        <outline text="createTable() : データから新規テーブルを生成(77304ebfbc33)" _note="管理者のみ実行可">
          <outline text="引数 : &lt;a href=&quot;https://workflowy.com/#/ea8faab5f9f2&quot;&gt;genTable()の引数&lt;/a&gt;と同じ" />
          <outline text="戻り値 {&lt;a href=&quot;https://workflowy.com/#/dab8cfcec9d8&quot;&gt;sdbLog&lt;/a&gt;}" />
        </outline>
        <outline text="selectRow() : テーブルから条件に合致する行を抽出(a8ac2d5e7372)">
          <outline text="引数">
            <outline text="arg {Object|Object[]}">
              <outline text="table {&lt;a href=&quot;https://workflowy.com/#/976403e08f0e&quot;&gt;sdbTable&lt;/a&gt;} 操作対象のテーブル管理情報" />
              <outline text="&lt;a href=&quot;https://workflowy.com/#/741ee9383b92&quot;&gt;where&lt;/a&gt; {Object|Function|string} 対象レコードの判定条件" />
            </outline>
          </outline>
          <outline text="戻り値 {Object[]} 該当行オブジェクトの配列" />
        </outline>
        <outline text="updateRow() : テーブルを更新(206036f40579)">
          <outline text="引数">
            <outline text="arg {Object}" _note="argの配列は使用しない。同一テーブルでも複数の条件で更新する場合、SpreadDb.arg.query自体を別オブジェクトで用意する">
              <outline text="table {&lt;a href=&quot;https://workflowy.com/#/976403e08f0e&quot;&gt;sdbTable&lt;/a&gt;} 操作対象のテーブル管理情報" />
              <outline text="&lt;a href=&quot;https://workflowy.com/#/741ee9383b92&quot;&gt;where&lt;/a&gt; {Object|Function|string} 対象レコードの判定条件" />
              <outline text="&lt;a href=&quot;https://workflowy.com/#/58dde3944536&quot;&gt;record&lt;/a&gt; {Object|string|Function} 更新する値" />
            </outline>
          </outline>
          <outline text="戻り値 {&lt;a href=&quot;https://workflowy.com/#/dab8cfcec9d8&quot;&gt;sdbLog&lt;/a&gt;[]}" />
        </outline>
        <outline text="appendRow() : テーブルに新規行を追加(288276ee622d)">
          <outline text="引数">
            <outline text="arg {Object|Object[]}">
              <outline text="table {&lt;a href=&quot;https://workflowy.com/#/976403e08f0e&quot;&gt;sdbTable&lt;/a&gt;} 操作対象のテーブル管理情報" />
              <outline text="&lt;a href=&quot;https://workflowy.com/#/58dde3944536&quot;&gt;record&lt;/a&gt; {Object|Object[]} 追加する行オブジェクト" />
            </outline>
          </outline>
          <outline text="戻り値 {&lt;a href=&quot;https://workflowy.com/#/dab8cfcec9d8&quot;&gt;sdbLog&lt;/a&gt;[]}" />
        </outline>
        <outline text="deleteRow() : テーブルから条件に合致する行を削除(30d4aa5c9fd7)">
          <outline text="引数">
            <outline text="arg {Object|Object[]}">
              <outline text="table {&lt;a href=&quot;https://workflowy.com/#/976403e08f0e&quot;&gt;sdbTable&lt;/a&gt;} 操作対象のテーブル管理情報" />
              <outline text="&lt;a href=&quot;https://workflowy.com/#/741ee9383b92&quot;&gt;where&lt;/a&gt; {Object|Function|string} 対象レコードの判定条件" />
            </outline>
          </outline>
          <outline text="戻り値 {&lt;a href=&quot;https://workflowy.com/#/dab8cfcec9d8&quot;&gt;sdbLog&lt;/a&gt;[]}" />
        </outline>
        <outline text="getSchema() : 指定されたテーブルの構造情報を取得(701a78c34e0a)">
          <outline text="引数">
            <outline text="arg {string|string[]} 取得対象テーブル名" />
          </outline>
          <outline text="戻り値 {Object.&amp;lt;string,&lt;a href=&quot;https://workflowy.com/#/df5b3c98954e&quot;&gt;sdbColumn&lt;/a&gt;[]&amp;gt;} {テーブル名：項目定義オブジェクトの配列}形式" />
        </outline>
      </outline>
      <outline text="typedefs(5a75202c3db4)">
        <outline text="メンバ(pv = private variables)(fa77053faee2)">
          <outline text="whois {string} 'SpreadDb'固定" />
          <outline text="opt {&lt;a href=&quot;https://workflowy.com/#/a4a26014ccb3&quot;&gt;sdbOption&lt;/a&gt;} 起動時オプション" />
          <outline text="spread {&lt;a href=&quot;https://developers.google.com/apps-script/reference/spreadsheet/spreadsheet?hl=ja&quot;&gt;Spread&lt;/a&gt;} スプレッドシートオブジェクト" />
          <outline text="table {Object.&amp;lt;string,&lt;a href=&quot;https://workflowy.com/#/976403e08f0e&quot;&gt;sdbTable&lt;/a&gt;&amp;gt;} スプレッドシート上の各テーブル(領域)の情報" />
          <outline text="log {&lt;a href=&quot;https://workflowy.com/#/dab8cfcec9d8&quot;&gt;sdbLog&lt;/a&gt;[]}=[] 更新履歴シートオブジェクト" />
        </outline>
        <outline text="sdbQuery {Object[]} 操作要求の内容(1e80990a7c63)" _note="以下、行頭の「crudas」はコマンドの種類により必要となるパラメータ。'r'はselect(read)&#10;">
          <outline text="table {string|string[]} 操作対象テーブル名" _note="全commandで使用。command='schema'の場合、取得対象テーブル名またはその配列&#10;" />
          <outline text="command {string} 操作名" _note="全commandで使用。「&lt;a href=&quot;https://workflowy.com/#/0055bda95f77&quot;&gt;commandの種類とrwdos文字列によるアクセス制御&lt;/a&gt;」参照" />
          <outline text="cols {&lt;a href=&quot;https://workflowy.com/#/df5b3c98954e&quot;&gt;sdbColumn&lt;/a&gt;[]} - 新規作成シートの項目定義オブジェクトの配列" _note="command='create'のみで使用" />
          <outline text="values {Object[]|Array[]} - 新規作成シートに書き込む初期値" _note="command='create'のみで使用" />
          <outline text="&lt;a href=&quot;https://workflowy.com/#/741ee9383b92&quot;&gt;where&lt;/a&gt; {Object|Function|string} 対象レコードの判定条件" _note="command='select','update','delete'で使用" />
          <outline text="&lt;a href=&quot;https://workflowy.com/#/58dde3944536&quot;&gt;record&lt;/a&gt; {Object|Function} 追加・更新する値" _note="command='update','append'で使用" />
          <outline text="isErr {boolean}=false command系メソッドで設定。対象レコード全てが正常終了ならfalse" _note="一つのqueryで複数の処理を指示した場合(ex.複数レコードの追加)、いずれか一つでもエラーになればisErrはtrueとなる。" />
          <outline text="2 Backlinks">
            <outline text="query {&lt;a href=&quot;https://workflowy.com/#/1e80990a7c63&quot;&gt;sdbQuery&lt;/a&gt;[]} 引数として渡されたqueryのコピー" />
            <outline text="query {&lt;a href=&quot;https://workflowy.com/#/1e80990a7c63&quot;&gt;sdbQuery&lt;/a&gt;[]} 操作要求、またはその配列" />
          </outline>
        </outline>
        <outline text="sdbOption {Object} オプション(a4a26014ccb3)">
          <outline text="userId {string}='guest' ユーザの識別子" _note="指定する場合、必ずuserAuthも併せて指定" />
          <outline text="userAuth {Object.&amp;lt;string,string&amp;gt;}={} テーブル毎のアクセス権限。&lt;code&gt;{シート名:rwdos文字列}&lt;/code&gt; 形式" _note="r:select(read), w:write, d:delete, s:schema, o:own only(指定シートのprimaryKeyがuserIdと一致するレコードのみ参照・変更可。削除不可)。追加はwがあれば可&#10;&#10;o(own record only)の指定は他の'rwdos'に優先、'o'のみの指定と看做す(rwds指定は有っても無視)。&#10;また検索対象テーブルはprimaryKey要設定、検索条件もprimaryKeyの値のみ指定可&#10;read/writeは自分のみ可、delete/schemaは実行不可&#10;" />
          <outline text="log {string}='log' 更新履歴テーブル名" _note="nullの場合、ログ出力は行わない。領域名 &amp;gt; A1記法 &amp;gt; シート名の順に解釈" />
          <outline text="maxTrial {number}=5 テーブル更新時、ロックされていた場合の最大試行回数" />
          <outline text="interval {number}=10000 テーブル更新時、ロックされていた場合の試行間隔(ミリ秒)" />
          <outline text="guestAuth {Object.&amp;lt;string,string&amp;gt;}={} ゲストに付与する権限。&lt;code&gt;{シート名:rwdos文字列}&lt;/code&gt; 形式" />
          <outline text="adminId {string}='Administrator' 管理者として扱うuserId" _note="管理者は全てのシートの全権限を持つ&#10;" />
          <outline text="2 Backlinks">
            <outline text="opt {&lt;a href=&quot;https://workflowy.com/#/a4a26014ccb3&quot;&gt;sdbOption&lt;/a&gt;}={} 起動時オプション" />
            <outline text="opt {&lt;a href=&quot;https://workflowy.com/#/a4a26014ccb3&quot;&gt;sdbOption&lt;/a&gt;} 起動時オプション" />
          </outline>
        </outline>
        <outline text="sdbTable {Object} テーブルの管理情報(976403e08f0e)">
          <outline text="name {string} テーブル名(範囲名)" />
          <outline text="account {string} 更新者のアカウント(識別子)" />
          <outline text="sheet {&lt;a href=&quot;https://developers.google.com/apps-script/reference/spreadsheet/sheet?hl=ja&quot;&gt;Sheet&lt;/a&gt;} スプレッドシート内の操作対象シート(ex.&quot;master&quot;シート)" />
          <outline text="schema {&lt;a href=&quot;https://workflowy.com/#/7b012b226f8e&quot;&gt;sdbSchema&lt;/a&gt;} シートの項目定義" />
          <outline text="values {Object[]} 行オブジェクトの配列。&lt;code&gt;{項目名:値,..}&lt;/code&gt; 形式" />
          <outline text="header {string[]} 項目名一覧(ヘッダ行)" />
          <outline text="notes {string[]} ヘッダ行のメモ" />
          <outline text="colnum {number} データ領域の列数" />
          <outline text="rownum {number} データ領域の行数(ヘッダ行は含まず)" />
          <outline text="7 Backlinks">
            <outline text="table {&lt;a href=&quot;https://workflowy.com/#/976403e08f0e&quot;&gt;sdbTable&lt;/a&gt;} 操作対象のテーブル管理情報" />
            <outline text="table {&lt;a href=&quot;https://workflowy.com/#/976403e08f0e&quot;&gt;sdbTable&lt;/a&gt;} 操作対象のテーブル管理情報" />
            <outline text="table {&lt;a href=&quot;https://workflowy.com/#/976403e08f0e&quot;&gt;sdbTable&lt;/a&gt;} 操作対象のテーブル管理情報" />
            <outline text="table {&lt;a href=&quot;https://workflowy.com/#/976403e08f0e&quot;&gt;sdbTable&lt;/a&gt;} 操作対象のテーブル管理情報" />
            <outline text="table {&lt;a href=&quot;https://workflowy.com/#/976403e08f0e&quot;&gt;sdbTable&lt;/a&gt;} 呼出元で処理対象としているテーブル" />
            <outline text="戻り値 {&lt;a href=&quot;https://workflowy.com/#/976403e08f0e&quot;&gt;sdbTable&lt;/a&gt;}" />
            <outline text="table {Object.&amp;lt;string,&lt;a href=&quot;https://workflowy.com/#/976403e08f0e&quot;&gt;sdbTable&lt;/a&gt;&amp;gt;} スプレッドシート上の各テーブル(領域)の情報" />
          </outline>
        </outline>
        <outline text="sdbSchema {Object} テーブルの構造情報(7b012b226f8e)">
          <outline text="cols {&lt;a href=&quot;https://workflowy.com/#/df5b3c98954e&quot;&gt;sdbColumn&lt;/a&gt;[]} 項目定義オブジェクトの配列" />
          <outline text="primaryKey {string}='id' 一意キー項目名" />
          <outline text="unique {Object.&amp;lt;string, any[]&amp;gt;} primaryKeyおよびunique属性項目の管理情報" _note="メンバ名はprimaryKey/uniqueの項目名&#10;" />
          <outline text="auto_increment {Object.&amp;lt;string,Object&amp;gt;} auto_increment属性項目の管理情報" _note="メンバ名はauto_incrementの項目名&#10;">
            <outline text="start {number} 開始値" />
            <outline text="step {number} 増減値" />
            <outline text="current {number} 現在の最大(小)値" _note="currentはsdbTableインスタンスで操作する。" />
          </outline>
          <outline text="defaultRow {Object|function} 既定値項目で構成されたオブジェクト。appendの際のプロトタイプ" />
          <outline text="2 Backlinks">
            <outline text="schema {&lt;a href=&quot;https://workflowy.com/#/7b012b226f8e&quot;&gt;sdbSchema&lt;/a&gt;}" />
            <outline text="schema {&lt;a href=&quot;https://workflowy.com/#/7b012b226f8e&quot;&gt;sdbSchema&lt;/a&gt;} シートの項目定義" />
          </outline>
        </outline>
        <outline text="sdbColumn {Object} 項目の構造情報(df5b3c98954e)" _note="= シート上のメモの文字列">
          <outline text="name {string} 項目名" />
          <outline text="type {string} データ型。string,number,boolean,Date,JSON,UUID" />
          <outline text="format {string} 表示形式。type=Dateの場合のみ指定" />
          <outline text="options {string} 取り得る選択肢(配列)のJSON表現" _note="ex. [&quot;未入場&quot;,&quot;既収&quot;,&quot;未収&quot;,&quot;無料&quot;]" />
          <outline text="default {function} 既定値を取得する関数。引数は当該行オブジェクト" _note="指定の際は必ず&lt;code&gt;{〜}&lt;/code&gt; で囲み、return文を付与のこと。&#10;ex.&lt;code&gt;o =&amp;gt; {return toLocale(new Date())}&lt;/code&gt; &#10;" />
          <outline text="primaryKey {boolean}=false 一意キー項目ならtrue" />
          <outline text="unique {boolean}=false primaryKey以外で一意な値を持つならtrue" />
          <outline text="auto_increment {bloolean|null|number|number[]}=false 自動採番項目" _note="null ⇒ 自動採番しない&#10;boolean ⇒ true:自動採番する(基数=1,増減値=1)、false:自動採番しない&#10;number ⇒ 自動採番する(基数=指定値,増減値=1)&#10;number[] ⇒ 自動採番する(基数=添字0,増減値=添字1)&#10;object ⇒ {start:m,step:n}形式" />
          <outline text="suffix {string} &quot;not null&quot;等、上記以外のSQLのcreate table文のフィールド制約" />
          <outline text="note {string} 本項目に関する備考" _note="ローカル側のcreate table等では使用しない" />
          <outline text="8 Backlinks">
            <outline text="戻り値 {Object.&amp;lt;string,&lt;a href=&quot;https://workflowy.com/#/df5b3c98954e&quot;&gt;sdbColumn&lt;/a&gt;[]&amp;gt;} {テーブル名：項目定義オブジェクトの配列}形式" />
            <outline text="column {&lt;a href=&quot;https://workflowy.com/#/df5b3c98954e&quot;&gt;sdbColumn&lt;/a&gt;} 項目の定義情報" />
            <outline text="arg {string|&lt;a href=&quot;https://workflowy.com/#/df5b3c98954e&quot;&gt;sdbColumn&lt;/a&gt;} シート上のメモの文字列またはsdbColumn" />
            <outline text="cols {&lt;a href=&quot;https://workflowy.com/#/df5b3c98954e&quot;&gt;sdbColumn&lt;/a&gt;[]} - 項目定義オブジェクトの配列" />
            <outline text="[cols] {&lt;a href=&quot;https://workflowy.com/#/df5b3c98954e&quot;&gt;sdbColumn&lt;/a&gt;[]} - 新規作成シートの項目定義オブジェクトの配列" />
            <outline text="schema {Object.&amp;lt;string,&lt;a href=&quot;https://workflowy.com/#/df5b3c98954e&quot;&gt;sdbColumn&lt;/a&gt;[]&amp;gt;} schemaで取得した{テーブル名：項目定義オブジェクトの配列}形式のオブジェクト" />
            <outline text="cols {&lt;a href=&quot;https://workflowy.com/#/df5b3c98954e&quot;&gt;sdbColumn&lt;/a&gt;[]} - 新規作成シートの項目定義オブジェクトの配列" _note="command='create'のみで使用" />
            <outline text="cols {&lt;a href=&quot;https://workflowy.com/#/df5b3c98954e&quot;&gt;sdbColumn&lt;/a&gt;[]} 項目定義オブジェクトの配列" />
          </outline>
        </outline>
        <outline text="sdbLog {Object} 更新履歴オブジェクト(dab8cfcec9d8)">
          <outline text="timestamp {string}=toLocale(new Date()) 更新日時(ISO8601拡張形式)" />
          <outline text="userId {string|number} uuid等、更新者の識別子" />
          <outline text="table {string} 更新対象テーブル名" />
          <outline text="command {string} 操作内容" _note="設定内容は「&lt;a href=&quot;https://workflowy.com/#/0055bda95f77&quot;&gt;commandの種類とrwdos文字列によるアクセス制御&lt;/a&gt;」参照" />
          <outline text="argument {string} 操作関数に渡された引数(JSON)" />
          <outline text="ErrCD {string} エラーコード" _note="rev.1.1.0 isErrとmessageを合併&#10;" />
          <outline text="before {JSON} 更新前の行データオブジェクト(JSON)" />
          <outline text="after {JSON} 更新後の行データオブジェクト(JSON)" />
          <outline text="diff {JSON} 追加の場合は行オブジェクト、更新の場合は差分情報" _note="{項目名：[更新前,更新後],...}形式" />
          <outline text="8 Backlinks">
            <outline text="戻り値 {&lt;a href=&quot;https://workflowy.com/#/dab8cfcec9d8&quot;&gt;sdbLog&lt;/a&gt;[]}" />
            <outline text="戻り値 {&lt;a href=&quot;https://workflowy.com/#/dab8cfcec9d8&quot;&gt;sdbLog&lt;/a&gt;[]}" />
            <outline text="戻り値 {&lt;a href=&quot;https://workflowy.com/#/dab8cfcec9d8&quot;&gt;sdbLog&lt;/a&gt;[]}" />
            <outline text="戻り値 {&lt;a href=&quot;https://workflowy.com/#/dab8cfcec9d8&quot;&gt;sdbLog&lt;/a&gt;}" />
            <outline text="戻り値 {&lt;a href=&quot;https://workflowy.com/#/dab8cfcec9d8&quot;&gt;sdbLog&lt;/a&gt;}" />
            <outline text="arg {Object.&amp;lt;string,any&amp;gt;} &lt;a href=&quot;https://workflowy.com/#/dab8cfcec9d8&quot;&gt;sdbLog&lt;/a&gt;に個別設定するメンバ名と値" />
            <outline text="log {&lt;a href=&quot;https://workflowy.com/#/dab8cfcec9d8&quot;&gt;sdbLog&lt;/a&gt;[]} 更新履歴" _note="update,deleteで該当無しの場合、log.length===0&#10;" />
            <outline text="log {&lt;a href=&quot;https://workflowy.com/#/dab8cfcec9d8&quot;&gt;sdbLog&lt;/a&gt;[]}=[] 更新履歴シートオブジェクト" />
          </outline>
        </outline>
        <outline text="sdbMain {Object[]} 主処理、ひいてはSpreadDb全体の戻り値(b03c5ccd2f8f)">
          <outline text="query {&lt;a href=&quot;https://workflowy.com/#/1e80990a7c63&quot;&gt;sdbQuery&lt;/a&gt;[]} 引数として渡されたqueryのコピー" />
          <outline text="row {Object[]}=null selectの該当行オブジェクトの配列" _note="該当無しの場合、row.length===0" />
          <outline text="schema {Object.&amp;lt;string,&lt;a href=&quot;https://workflowy.com/#/df5b3c98954e&quot;&gt;sdbColumn&lt;/a&gt;[]&amp;gt;} schemaで取得した{テーブル名：項目定義オブジェクトの配列}形式のオブジェクト" />
          <outline text="log {&lt;a href=&quot;https://workflowy.com/#/dab8cfcec9d8&quot;&gt;sdbLog&lt;/a&gt;[]} 更新履歴" _note="update,deleteで該当無しの場合、log.length===0&#10;" />
          <outline text="1 Backlink">
            <outline text="戻り値 {&lt;a href=&quot;https://workflowy.com/#/b03c5ccd2f8f&quot;&gt;sdbMain&lt;/a&gt;}" />
          </outline>
        </outline>
        <outline text="sdbGenSchema {Object} genSchemaの戻り値(2609271977a8)" _note="sdbSchemaにメモ情報を付加">
          <outline text="schema {&lt;a href=&quot;https://workflowy.com/#/7b012b226f8e&quot;&gt;sdbSchema&lt;/a&gt;}" />
          <outline text="notes {string[]} ヘッダ行に対応したメモ" />
          <outline text="1 Backlink">
            <outline text="戻り値 {&lt;a href=&quot;https://workflowy.com/#/2609271977a8&quot;&gt;sdbGenSchema&lt;/a&gt;}" />
          </outline>
        </outline>
        <outline text="sdbConvertRow {Object} convertRowの戻り値(01ee6b06c8a6)">
          <outline text="raw {any[][]} シートイメージ" />
          <outline text="obj {Object[]} 行オブジェクトの配列" />
          <outline text="header {string} ヘッダ行" />
          <outline text="1 Backlink">
            <outline text="戻り値 {&lt;a href=&quot;https://workflowy.com/#/01ee6b06c8a6&quot;&gt;sdbConvertRow&lt;/a&gt;}" />
          </outline>
        </outline>
      </outline>
      <outline text="variables(235f8a9e77af)" _note="複数属性が定義され、内容によって意味が変わる変数の解説">
        <outline text="where {Object|Function|string} 対象レコードの判定条件(741ee9383b92)" _note="- Object ⇒ {キー項目名:キー項目の値}形式で、key:valueに該当するレコードを更新&#10;- function ⇒ 行オブジェクトを引数に対象ならtrueを返す関数で、trueが返されたレコードを更新&#10;- string&#10;  - 無名関数またはアロー関数のソース文字列 ⇒ new Functionで関数化。&lt;code&gt;{〜}&lt;/code&gt; で囲みreturn文を付与。&#10;  - その他 ⇒ 項目定義で&quot;primaryKey&quot;を指定した項目の値&#10;- その他(Object,function,string以外) ⇒ 項目定義で&quot;primaryKey&quot;を指定した項目の値&#10;">
          <outline text="4 Backlinks">
            <outline text="&lt;a href=&quot;https://workflowy.com/#/741ee9383b92&quot;&gt;where&lt;/a&gt; {Object|Function|string} 対象レコードの判定条件" />
            <outline text="&lt;a href=&quot;https://workflowy.com/#/741ee9383b92&quot;&gt;where&lt;/a&gt; {Object|Function|string} 対象レコードの判定条件" />
            <outline text="&lt;a href=&quot;https://workflowy.com/#/741ee9383b92&quot;&gt;where&lt;/a&gt; {Object|Function|string} 対象レコードの判定条件" />
            <outline text="&lt;a href=&quot;https://workflowy.com/#/741ee9383b92&quot;&gt;where&lt;/a&gt; {Object|Function|string} 対象レコードの判定条件" _note="command='select','update','delete'で使用" />
          </outline>
        </outline>
        <outline text="record {Object|string|Function} 更新する値(58dde3944536)" _note="record句の指定方法&#10;- Object ⇒ appendなら行オブジェクト、updateなら{更新対象項目名:セットする値}&#10;- string ⇒ 上記Objectに変換可能なJSON文字列&#10;- Function ⇒ 行オブジェクトを引数に、上記Objectを返す関数&#10;  【例】abc欄にfuga+hogeの値をセットする : {func: o=&amp;gt;{return {abc:(o.fuga||0)+(o.hoge||0)}}}">
          <outline text="3 Backlinks">
            <outline text="&lt;a href=&quot;https://workflowy.com/#/58dde3944536&quot;&gt;record&lt;/a&gt; {Object|Object[]} 追加する行オブジェクト" />
            <outline text="&lt;a href=&quot;https://workflowy.com/#/58dde3944536&quot;&gt;record&lt;/a&gt; {Object|string|Function} 更新する値" />
            <outline text="&lt;a href=&quot;https://workflowy.com/#/58dde3944536&quot;&gt;record&lt;/a&gt; {Object|Function} 追加・更新する値" _note="command='update','append'で使用" />
          </outline>
        </outline>
      </outline>
      <outline text="用語解説、注意事項(56eaf36cc785)">
        <outline text="関数での抽出条件・値の指定時の制約(2df536ff0f8d)" _note="default(sdbColumn), where, record(update他)では関数での指定を可能にしている。&#10;これらをセル・メモで保存する場合、文字列に変換する必要があるが、以下のルールで対応する。&#10;&#10;- 引数は行オブジェクトのみ(引数は必ず一つ)&#10;- 関数に復元する場合`new Function('o',[ロジック部分文字列])で関数化&#10;  - 必ず&quot;{〜}&quot;で囲み、return文を付ける&#10;" />
        <outline text="commandの種類とrwdos文字列によるアクセス制御(0055bda95f77)" _note="commandの種類は下表の通り。&amp;lt;br&amp;gt;&#10;&quot;rwdos&quot;とは&quot;Read/Write/Delete/Own/Schema&quot;の頭文字。管理者のみ実行可能な&quot;c&quot;(createTable)と特殊権限&quot;o&quot;を加えてシート毎のアクセス制御を行う。&#10;&#10;内容 | command | rwdos&#10;:-- | :-- | :-- &#10;テーブル生成 | create | c&#10;参照 | select | r&#10;更新 | update | rw&#10;追加 | append/insert | w&#10;削除 | delete | d&#10;テーブル管理情報取得 | schema | s&#10;&#10;特殊権限'o' : イベント申込情報等、本人以外の参照・更新を抑止するためのアクセス権限。&#10;- `userAuth:{シート名:o}`が指定された場合、当該シートのprimaryKey=userIdとなっているレコードのみ'r','w'可と看做す。&#10;- 'o'指定が有るシートのアクセス権として'rwds'が指定されていても'o'のみ指定されたと看做す&#10;- 'o'指定でselect/updateする場合、where句は無視され自情報に対する処理要求と看做す&#10;  ex. userId=2の人がuserId=1の人の氏名の更新を要求 ⇒ userId=2の氏名が更新される&#10;  ```&#10;  SpreadDb(&#10;    {table:'camp2024',command:'update',where:1,record:{'申込者氏名':'テスト'}},&#10;    {userId:2,userAuth:{camp2024:'o'}}&#10;  ); // -&amp;gt; userId=2の氏名が「テスト」に&#10;  ```">
          <outline text="2 Backlinks">
            <outline text="command {string} 操作名" _note="全commandで使用。「&lt;a href=&quot;https://workflowy.com/#/0055bda95f77&quot;&gt;commandの種類とrwdos文字列によるアクセス制御&lt;/a&gt;」参照" />
            <outline text="command {string} 操作内容" _note="設定内容は「&lt;a href=&quot;https://workflowy.com/#/0055bda95f77&quot;&gt;commandの種類とrwdos文字列によるアクセス制御&lt;/a&gt;」参照" />
          </outline>
        </outline>
      </outline>
      <outline text="更新履歴(d154b1fe324f)" _note="- rev.1.2.0 : 2025/01/04〜&#10;  - エラー発生時、messageではなくエラーコードで返すよう変更&#10;  - 1つの処理要求(query)で複数レコードを対象とする場合、一レコードでもエラーが発生したらエラーに&#10;  - 変更履歴シートのUUIDは削除" />
    </outline>
  </body>
</opml>
