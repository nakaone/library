<!DOCTYPE html><html xml:lang="ja" lang="ja"><head>
<script type="text/javascript" class="content">
const content = [
{
title: "mac OS標準Apache httpdの起動と終了",
created: "2023/07/21 08:00",
tag: ['Apache','httpd','mac OS標準','起動','停止'],
content: 
`\`\`\`
% which httpd   # httpdがインストールされているパスの確認
/usr/sbin/httpd
% which apachectl #apachectlがインストールされているパスの確認
/usr/sbin/apachectl
% /usr/sbin/httpd -version  # httpdのバージョン
Server version: Apache/2.4.56 (Unix)
Server built:   Apr 15 2023 04:26:33
% sudo /usr/sbin/apachectl start  # httpdの起動
Password:
/System/Library/LaunchDaemons/org.apache.httpd.plist: service already loaded
Load failed: 37: Operation already in progress
% sudo /usr/sbin/apachectl stop # httpdの停止
\`\`\`
`,
},{ // --------------------------------------------------------
title: "DocumentRootの確認",
created: "2023/07/21 08:00",
tag: ['Apache','httpd','mac OS標準','DocumentRoot'],
content: 
`\`\`\`
% cd /etc/apache2 # httpd.confの格納場所
% ls -la
total 88
drwxr-xr-x   9 root  wheel    288  6 15 19:08 .
drwxr-xr-x  79 root  wheel   2528  7 20 18:17 ..
drwxr-xr-x  14 root  wheel    448  6 15 19:08 extra
-rw-r--r--   1 root  wheel  21648  6 15 19:08 httpd.conf
-rw-r--r--   1 root  wheel  13064  6 15 19:08 magic
-rw-r--r--   1 root  wheel  61118  6 15 19:08 mime.types
drwxr-xr-x   4 root  wheel    128  6 15 19:08 original
drwxr-xr-x   4 root  wheel    128  6 15 19:08 other
drwxr-xr-x   2 root  wheel     64  6 15 19:08 users
% vi httpd.conf # 以降viの画面
-------------------------
# DocumentRoot: The directory out of which you will serve your
# documents. By default, all requests are taken from this directory, but
# symbolic links and aliases may be used to point to other locations.
# 
DocumentRoot "/Library/WebServer/Documents"  <-- ここ
-------------------------
:/DocumentRoot
-------------------------
% cd /Library/WebServer/Documents # 現状の内容確認(2023/7/20)
% ls 
css		index.html	js
img		index.html.en	src
\`\`\`
`},
{ // =====================================================================
  title: "MacのLocalhostで起動中のサーバにAndroidスマートフォンからアクセスする",
  created: "2023/07/21 08:00",
  tag: ['Apache','httpd','mac OS標準','スマホ','開発'],
  ref: [{
    site: "",
    title:"MacのLocalhostで起動中のサーバにAndroidスマートフォンからアクセスする",
    url:"https://knmts.com/as-a-engineer-38/",
  }], content:
  // =====================================================================
`通常は\`http://localhost/\`または\`http://127.0.0.1/\`。

\`\`\`
% ifconfig en0
en0: flags=8863<UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST> mtu 1500
  options=6463<RXCSUM,TXCSUM,TSO4,TSO6,CHANNEL_IO,PARTIAL_CSUM,ZEROINVERT_CSUM>
  ether 0c:e4:41:e8:71:85 
  inet6 fe80::4b8:8c63:f0e5:60cb%en0 prefixlen 64 secured scopeid 0xc 
  inet6 2404:7a80:2301:2b00:1014:c9e8:5021:1907 prefixlen 64 autoconf secured 
  inet6 2404:7a80:2301:2b00:6d66:9e73:e45d:1308 prefixlen 64 autoconf temporary 
  inet 192.168.1.7 netmask 0xffffff00 broadcast 192.168.1.255
  nat64 prefix 2001:260:306:b:: prefixlen 96
  nd6 options=201<PERFORMNUD,DAD>
  media: autoselect
  status: active
\`\`\`
`},
];
  </script>
  <title>Tips</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!-- UML: PlantUML
    参考：JavaScriptを用いてPlantUMLを呼び出す
    https://168iroha.net/blog/topic/?id=202206081036&sorting=post_date  -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/plantuml-encoder@1.4.0/dist/plantuml-encoder.min.js"></script>
  <!-- MarkDownテキストをHTML化するCDN -->
  <script src="https://taisukef.github.io/marked_md/marked.min.js"></script>
  <!-- MermaidテキストをHTML化するCDN -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10.2.4/dist/mermaid.min.js"></script>

  <style type="text/css">
    h1 {
      font-size: 1.6rem;
      text-shadow:2px 2px 4px #888;
    }
    .tag, .list {
      margin: 1rem 0px;
      padding: 1rem;
      border: double 3px #ddd;
    }
    .prop {
      font-size: 0.8rem;
      background-color: #ddd;
    }
  </style>
</head>
<body>
<h1>Tips</h1>
<div id="key">
  <input type="text" placeholder="検索キーワード">
  <button onclick="clearKeyword()">clear</button>
  <div class="tag"></div><!-- タグの一覧 -->
  <div class="list"></div><!-- 候補記事のリスト -->
</div>
<div class="detail"></div><!-- 詳細(記事本文) -->

<!-- 自作ライブラリ -->
<script src="component/createElement.js"></script>
<script src="component/mergeDeeply.js"></script>

<script type="text/javascript" class="main">
/**
 * 検索キーワード欄をクリア
 */
function clearKeyword(){
  console.log('clear');
  document.querySelector('input').value='';
}

/**
 * 詳細(記事本文)の表示
 * @param {number} arg - 記事のNo(DOMContentLoadedで採番)
 * @returns {void}
 */
function showDetail(arg){
  const v = {
    detail:document.querySelector('.detail'),
    list: document.querySelector('.list'),
    arg: content[arg],  // 記事のオブジェクト
  };
  console.log('showDetail start.');

  // リスト表示域をクリア
  v.list.innerHTML = '';

  // 詳細表示域の内容作成
  v.detail.innerHTML = ''; // 詳細表示域をクリア
  v.element = createElement({children:[
    {tag:'h1',attr:{name:"title"},text:v.arg.title},
    {attr:{class:"prop"},children:[ // 属性情報
      {attr:{name:"created"},text:'created: '+v.arg.created},
      {attr:{name:"updated"},text:'updated: '+v.arg.updated},
      {attr:{name:"tag"},text:'tag: '+v.arg.tag.join(', ')},
      {attr:{name:"ref"}},
    ]},{  // 記事本文
      attr:{name:"content",class:"markdown"},
      html:marked(v.arg.content)
    },
  ]});
  // 参照文献を追加
  if( v.arg.ref && v.arg.ref.length > 0 ){
    v.ol = createElement({tag:'ol'});
    v.arg.ref.forEach(x => {v.ol.appendChild(
      createElement({tag:'li',
        text:((x.site && x.site.length>0) ? x.site+': ' : ''),
        children:[
        {tag:'a',attr:{href:x.url},text:x.title}
    ]}))});
    v.element.querySelector('[name="ref"]').appendChild(v.ol);
  }
  v.detail.appendChild(v.element);

  // Mermaidで記述された部分をHTML化して表示
  mermaid.initialize({startOnLoad: true});

  console.log('showDetail end.');
}

/**
 * 候補記事リストを表示
 * @param {string} [arg=''] - 検索キーワード(タグ名)
 * @returns {void}
 */
function showList(arg=''){
  const v = {
    key: document.querySelector('input'),
    list: document.querySelector('.list'),
    detail: document.querySelector('.detail'),
    keyword: [],  // 検索キーワード集
    result: JSON.parse(JSON.stringify(content)),
  }
  console.log('showList: '+arg);

  // 詳細表示領域をクリア
  v.detail.innerHTML = '';

  // 検索キーワードをv.keyword配列に格納
  v.keyword = arg.length > 0 ? [arg.toLowerCase()]
  : v.key.value.toLowerCase().split(/\s+/);
  console.log(v.keyword);

  // キーワードが存在した記事はフラグを立てる
  if( v.keyword.length === 0 ){
    // キーワード指定無しなら全件表示
    content.forEach(x => x.flag = true);
    v.cnt = content.length;
  } else {
    v.cnt = 0;  // 該当件数
    content.forEach(x => {
      x.flag = true;
      for( v.k of v.keyword ){
        console.log(x,'\nk='+v.k+', str='+x.str);
        if( x.str.indexOf(v.k) < 0 ) x.flag = false;
      }
      v.cnt += x.flag ? 1 : 0;
      v.lastHit = x.no; // 1件のみ該当の場合に使用
    });
  }

  // 該当件数に応じて処理分岐
  if( v.cnt === 0 ){
    alert('該当無し');
  } else if( v.cnt === 1 ){
    showDetail(v.lastHit);
  } else {
    // リスト領域に結果を一覧表示
    v.list.innerHTML = '';
    for( v.i=0 ; v.i<content.length ; v.i++ ){
      if( content[v.i].flag ){
        v.list.appendChild(createElement({
        style:{
          display: "grid",
          gridTemplateColumns: "10rem 1fr"},
          children:[
            {text:(content[v.i].updated || content[v.i].created)},
            {tag:'a',text: content[v.i].title,
              attr:{onclick:"showDetail("+content[v.i].no+")"}},
          ]
        }));
      }
    }
  }
}

/**
 * データの初期処理
 */
function initialize(){
  const v = {tag:[]}
  console.log("initialize start.");

  // Noと検索対象文字列を設定
  for( let i=0 ; i<content.length ; i++ ){
    // 既定値の設定
    content[i] = mergeDeeply({
      title:'',
      created:null,
      updated:null,
      tag:[],
      ref:[],
      content:''
    },content[i]);

    // Noを設定
    content[i].no = i;

    // 被検査文字列を作成
    content[i].str = content[i].title + content[i].tag.join() + content[i].content;
    if( content[i].ref.length > 0 ){
      content[i].ref.forEach(y => {
        y.site = y.site || '';
        content[i].str += y.site + y.title; // 参考サイトのタイトルも追加
      });
    }
    content[i].str = content[i].str.toLowerCase();  // 小文字に統一

    // 各記事のタグを単純に集めた配列
    v.tag = v.tag.concat(content[i].tag);
  }

  // 重複を排除して整列
  v.tag = v.tag.filter((value,index) => {
    return index === v.tag.indexOf(value);
  }).sort();
  // タグリストを表示
  v.tagList = document.querySelector('.tag');
  v.tagList.innerHTML = '';
  for( v.i=0 ; v.i<v.tag.length ; v.i++ ){
    v.tagList.innerHTML +=
      '<a onclick="showList(\''
      + v.tag[v.i].toLowerCase()  // キーワードは小文字に統一
      + '\')">'
      + v.tag[v.i] + "</a> "
  }

  console.log("initialize end.");
}

window.addEventListener('DOMContentLoaded',() => {
  document.querySelector('input')
    .addEventListener('keyup',()=>showList());
  initialize();
  showList();  // 画面を描画
});
</script></body></html>