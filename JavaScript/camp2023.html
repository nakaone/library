<!DOCTYPE html><html xml:lang="ja" lang="ja">
<head>
  <title>校庭キャンプ2023</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <!-- UML: PlantUML
    参考：JavaScriptを用いてPlantUMLを呼び出す
    https://168iroha.net/blog/topic/?id=202206081036&sorting=post_date
  -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/plantuml-encoder@1.4.0/dist/plantuml-encoder.min.js"></script>

  <!-- MarkDownテキストをHTML化するCDN -->
  <script src="https://taisukef.github.io/marked_md/marked.min.js"></script>
  <style type="text/css">
    .image {
      max-width: 100%;
      overflow: scroll;
    }
    .timetable, .timetable div {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      display: grid;
      --color: #ccc;
    }
    .timetable .main .header {
      grid-template-columns: repeat(3, 1fr);
      border: solid 2px var(--color);
      padding-left: 0.3rem;
    }
    .timetable .main .header div:nth-child(2n) {
      background-color: var(--color);
    }
    .timetable .gantt .task {
      grid-template-rows: 1fr;
      grid-template-columns: 1fr;
    }

    .timetable .gantt .grid {
      grid-row: 1/2;
      grid-column: 1/2;
      grid-template-columns: repeat(12, 1fr);
    }
    .timetable .gantt .grid div {
      min-height: 1rem;
    }
    .timetable .gantt .grid div:nth-child(2n+1) {
      border-left: solid 2px var(--color);
    }
    .timetable .gantt .grid div:nth-child(2n) {
      border-left: dotted 1px var(--color);
    }
    .timetable .gantt .grid div:last-child {
      border-right: solid 2px var(--color);
    }
    .timetable .gantt .chart {
      grid-row: 1/2;
      grid-column: 1/2;
      z-index: 1;
      grid-template-columns: repeat(36, 1fr);
    }
    .timetable .gantt .chart div[name="1.1"] {
      grid-column: 4/12;
      background-color: var(--color);
    }
    .timetable .gantt .chart div[name="1.2"] {
      grid-column: 9/20;
      background-color: var(--color);
    }
    .timetable .gantt .chart .space {
      grid-column: 1/37;
      height: 0.5rem;
    }
  </style>
</head>
<body>
  <div><h1>スケジュール</h1>
    <div class="image"><img name="schedule1"></img></div>
    <div name="schedule2"></div>
  </div>

  <div><h1>タイムテーブル</h1>
    <div class="timetable" name="tt01">
      <div class="controller">コントローラ</div>
      <div class="main">
        <div class="header">
          <div>8:00</div>
          <div>9:00</div>
          <div>10:00</div>
        </div>
        <div class="gantt">
          <div class="label">午前の部</div>
          <div class="task">
            <div class="grid">
              <div></div><div></div><div></div><div></div>
              <div></div><div></div><div></div><div></div>
              <div></div><div></div><div></div><div></div>
            </div>
            <div class="chart">
              <div class="space"></div>
              <div name="1.1">受付</div>
              <div class="space"></div>
              <div name="1.2">挨拶</div>
              <div class="space"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="dialog">ダイアログ</div>
    </div>

    <div class="timetable" name="tt02"></div>
  </div>

  <div><h1>参考：論議メモ</h1>
    <details><summary>2023/06/10 定例会</summary>
      <div name="20230610"></div>
    </details>
  </div>

  <!--
    スケジュール
  -->
  <script type="text/javascript" class="PlantUML" name="schedule1">/*
    @startgantt
    project starts the 2023/07/08
    saturday are closed
    sunday are closed
    2023/07/08 is open
    2023/09/09 is open
    2023/09/23 is open
    2023/09/30 is open
    2023/10/01 is open
    hide ressources footbox

    [終業式] happens 2023/07/20
    [夏休み] starts at [終業式]'s end and ends 2023/08/31

    -- 参加者募集：夏休み前予告 --
    [7月定例会] starts 2023/07/08 and ends 2023/07/08
    then [予告サイト作成] as [site] on {嶋津} lasts 2 days
    [QRコード送付①] happens at [site]'s end
    [予告チラシ作成] starts 2023-07-10 and lasts 3 days
    then [内部レビュー] lasts 2 days
    then [学校側確認①] lasts 2 days
    then [印刷・配布①] ends 2023-07-20

    -- 参加者募集：本番 --
    [9月定例会] starts 2023/9/9 and lasts 1 days
    [手伝募集メール発信] on {嶋津} starts at [9月定例会]'s end and lasts 1 days
    [調理器具他、不足資材の手配] starts at [9月定例会]'s end and lasts 2 weeks
    [臨時会] starts 2023/9/23 and lasts 1 days
    then [テント区画図・案内板作成] lasts 1 weeks
    [サイト・申込フォーム作成] starts 2023/08/30 and lasts 5 days
    then [申込状況参照サイト作成] on {嶋津} lasts 4 days
    [QRコード送付②] on {嶋津} happens 2023/09/01
    [チラシ・しおり作成] starts 2023/08/30 and lasts 5 days
    then [学校側確認②] lasts 4 days
    then [印刷・配布②] lasts 1 days
    [参加申し込み] starts at [印刷・配布②]'s end and lasts 2 weeks
    [抽選・調整] starts at [参加申し込み]'s end and lasts 1 weeks
    [リマインドメール発信] on {嶋津} happens 2023/09/29
    [しおり印刷] starts at [参加申し込み]'s end and ends 2023/09/29
    [本番] starts at [抽選・調整]'s end and ends 2023/10/01

    -- アンケート・撮影・まとめ --
    [アンケート叩き台・写真保存手順作成] on {嶋津} starts at [申込状況参照サイト作成]'s end and lasts 5 days
    then [レビュー・修正] lasts 5 days
    [撮影] starts 2023/09/30 and ends 2023/10/01
    then [写真保存] on {スタッフ} lasts 3 days
    [参加者アンケート回答依頼メール発信] on {嶋津} happens 2023/10/01
    then [参加者アンケート回答] lasts 5 days
    [当日スタッフアンケート回答依頼メール発信] on {嶋津} happens 2023/10/01
    then [当日スタッフアンケート回答] on {当日スタッフ} lasts 5 days
    [次回申送事項シート記入] on {おやじ常連} starts at [当日スタッフアンケート回答依頼メール発信]'s end and lasts 5 days
    [まとめ] starts at [参加者アンケート回答]'s end and lasts 10 days

    @endgantt
  */</script>

  <script type="text/javascript" class="markdown" name="schedule2">/*
1. 予備日の作業内容
    1. 欠席連絡があった場合、待機者の繰上当選連絡[嶋津]
    1. 参加者名簿の作成[嶋津]
    1. 参加のしおり印刷[未定]

1. 調査および成果物
    1. 校庭・体育館区画 -> 区画図
    1. トイレ他、要案内箇所 -> 案内図
  
  */</script>

  <script type="text/javascript" class="markdown" name="20230610">/*
1. 日程：9/23〜24 or **9/30〜10/01**(第一候補) or 10/07〜08(第二候補) or 10/08〜09(第三候補)
1. 人数制限を設けるか
   - 親父の会の人員でカバーできる範囲で
   - 当日参加不可(昨年度キャパオーバーした)
   - 予約を人数制限する
1. イベント数を絞る
1. 料金：500円/人(小学生以上)
1. お手伝いを必須にする<br>
  予約サイトのチェック必須にする
1. テントの設置数、大きさの制限<br>
  学年ごと<br>
  区画の大きさ、テントの大きさ、タープNG<br>
  おやじが張る場所を指定(当日対応)
1. 体育館の利用<br>
  テントの無い児童
1. 未就学児のスペース
1. ビオトープなどの安全管理
1. 飯田さん(スノーピーク)の進捗
1. カレーの配布方法：学年ごと
   - 同学年の親が手伝う
   - 小鍋を準備する
1. 担当を明確にする
1. 開始時刻 -> 14:00〜
1. ボールを片付けておく
1. 児童の怪我などは自己責任を明文化しておく
1. お化け
   - 中学生の評判良かったが、大人がもう一人必要(安全確保のため)
  */</script>

  <script type="text/javascript" class="main">

    /**
     * @typedef {Object} Member - タスクの達成に必要な人的資源
     * @prop {number} ideal - 理想的な担当者数
     * @prop {string[]} fixed - 担当者名の配列
     * 
     * @typedef {Object} Resource - タスク達成に必要な資源
     * @prop {string} name - 資源の名前。ビニール紐、等
     * @prop {number} quantity - 必要な数量
     * @prop {string} unit - 単位名。円、個、等
     * @prop {string} procurement - 調達方法。学校、○○さん持参、購入、等
     * @prop {number} budget - 必要な予算額(見込)
     * @prop {string} note - 備考
     * 
     * 
     * @typedef {Object} Task - タスクの定義
     * @prop {string} id - 親ID＋自No。プログラム内部で自動採番
     * @prop {string} label - セクションまたはタスクのラベル
     * @prop {string} summary - タスクの概要
     * @prop {string} note - 備考
     * @prop {Task[]} [children] - 子タスクの配列。指定した場合、以下は指定不可
     * 
     * @prop {Date} start - 開始日時
     * @prop {Date} end - 終了日時
     * @prop {string} location - 集合場所、作業場所
     * @prop {Member} members - タスクの担当者(人的資源)
     * @prop {Resource[]} resources - タスクの達成に必要な物的資源
     * @prop {string} output - タスクの成果物
     * @prop {string} style - タスクをバー表示する時の表示スタイル
     * 
     * 
     * @typedef {Object.<string>:<string>} CSSDef - 要素のデザインのオブジェクト。JavaScriptでのプロパティ名：値となるオブジェクト
     * 
     * @typedef {Object} Project
     * @prop {Task[]} tasks - 目標達成に必要なタスクの配列
     * @prop {Object.<string>:<CSSDef>} design - タスクをバー表示する時のスタイル定義
     * @prop {number} unit=5 - バーを表示する際の精度(単位：分)
     * 
     */

    const ttData = {
      unit: 5,
      design: {
        default: {
          color: "#000",
          backgroundColor: "rgba(196,196,196,0.6)",
          border: "solid 1px #aaa",
        },
        critical: {
          color: "#fff",
          backgroundColor: "rgba(255,96,96,0.6)",
          border: "solid 1px #f00",
        },
      },
      tasks: [{
        label: "受付",
        summary: "参加者の受付",
        note: "正門近辺の駐輪に注意",
        start: "2023-09-30T14:00:00",
        end: "2023-09-30T15:30:00",
        location: "正門",
        members: {
          ideal: 10,
          fixed: ['嶋津','織田','羽柴','徳川'],
        },
        resources: [
          {name:"参加者名簿",quantity:2,unit:"冊",procurement:"嶋津が持参",budget:0,note:""},
          {name:"文鎮",quantity:4,unit:"個",procurement:"担当者が持参",budget:0,note:""},
          {name:"カラーコーン",quantity:12,unit:"本",procurement:"遊び場",budget:0,note:""},
        ],
        output: "記入済み名簿",
        style: "default",
      },{
        label: "カレー作成",
        summary: "",
        note: "中高生ボランティア参加の可能性あり",
        children: [
          {
            label: "材料買い出し",
            summary: "青果・肉・ルーを買い出し",
            note: "事前発注は不要(例年してない)",
            start: "2023-09-30T09:30:00",
            end: "2023-09-30T10:50:00",
            location: "正門",
            members: {
              ideal: 4,
              fixed: ['国生','河合','高井'],
            },
            resources: [
              {name:"牛スネ肉",quantity:10,unit:"kg",procurement:"購入",budget:30000,note:"@250/100g以内"},
              {name:"玉ねぎ",quantity:4,unit:"kg",procurement:"購入",budget:50000,note:""},
            ],
            output: "特になし",
            style: "critical",
          },
        ]
      }]
    };

    function timetable(element,data){
      const v = {
        minTime: Infinity, // task.startの最小値。UNIX時刻
        maxTime: -Infinity,
        startHour: Infinity, // minTime以下の正時となるUNIX時刻。表示領域の左端
        endHour: -Infinity,  // maxTime以上の正時となるUNIX時刻。表示領域の右端
        createDivElement: (arg) => { // DIV要素を生成、属性を指定する
          let rv = document.createElement('tag');
          for( let x in arg )
            rv.setAttribute(x,arg[x]);
          return rv;
        },
        timeRange: (dArray) => {  // v.minTime, v.maxTimeの取得
          console.log(dArray);
          for( let task of dArray ){
            if( 'children' in task ){
              v.timeRange(task.children);
            } else {
              v.st = new Date(task.start).getTime();
              v.ed = new Date(task.end).getTime();
              if( v.minTime > v.st ) v.minTime = v.st;
              if( v.maxTime < v.ed ) v.maxTime = v.ed;
            }
          }
        },
        appendTask: (task,pId,seq) => { // ガントチャートの作成：いまここ
          if( 'children' in task ){
            // ラベル行：ラベル行を追加
            v.labelElement = v.createDivElement({class:'label'});
            v.labelElement.innerText = pId+seq+'.'+task.label;
            v.ganttElement.appendChild(v.labelElement);
            for( let i=0 ; i<task.children.length ; i++ )
              v.appendTask(task.children[i],pId+seq+'.',i);
          } else {
            // タスク：gridとchartをまとめたtaskを作成
            v.taskElement = v.createDivElement({class:'task'});
            // gridを作成
            v.gridElement = v.createDivElement({class:'grid'});
            v.gridElement.innerHTML = '<div></div>'.repeat((v.endHour-v.startHour)/900000);
            // gridをtaskに追加
            v.taskElement.appendChild(v.gridElement);
            // chartを作成
            v.chartElement = v.createDivElement({class:'chart'});
            // chartをtaskに追加
            v.taskElement.appendChild(v.chartElement);
            // taskをganttに追加
            v.ganttElement.appendChild(v.taskElement);
          }
        },
      };

      // 事前準備
      v.timeRange(data.tasks);
      v.startHour = Math.floor(v.minTime / 3600000) * 3600000;
      v.endHour = Math.ceil(v.maxTime / 3600000) * 3600000;
      /*console.log(new Date(v.minTime));
      console.log(new Date(v.maxTime));
      console.log(new Date(v.startHour));
      console.log(new Date(v.endHour));*/

      // 1.controllerの要素を作成
      v.controllerElement = v.createDivElement({class:"controller"});
      // controllerの要素を追加
      element.appendChild(v.controllerElement);

      // 2.mainの要素を作成
      v.mainElement = v.createDivElement({class:"main"});

      // 2.1.main.headerの要素を作成
      v.headerElement = v.createDivElement({class:"header"});
      v.num = 0; // startHour〜endHourまでの時間数
      for( v.i=v.startHour ; v.i<=v.endHour ; v.i+=3600000 ){
        v.o = v.createDivElement();
        v.o.innerText = new Date(v.i).getHours() + ':00';
        v.headerElement.appendChild(v.o);
        v.num++;
      }
      v.headerElement.style.gridTemplateColumns = 'repeat('+v.num+', 1fr)';
      
      // 2.1.main.headerの要素をmainに追加
      v.mainElement.appendChild(v.headerElement);

      // 2.2.main.ganttの要素を作成
      v.ganttElement = v.createDivElement({class:"gantt"});

      for( let i=0 ; i<data.tasks.length ; i++ ){
        v.appendTask(data.tasks[v.i],'',i);
      }

      // 2.2.main.ganttの要素をmainに追加
      v.mainElement.appendChild(v.ganttElement);

      // mainの要素を追加
      element.appendChild(v.mainElement);


      // dialogの要素を作成
      v.dialogElement = v.createDivElement({class:"dialog"});
      // dialogの要素を追加
      element.appendChild(v.dialogElement);

      /*
      // 第一階層の要素を作成
      ['controller','main','dialog'].forEach(x => v[x]=v.createElement({tag:'div',class:x}));

      // main.headerの作成
      v.main.appendChild(v.header());

      // main.ganttの作成
      v.gantt = v.createElement({tag:'div',class:'gantt'});
      for( v.i=0 ; v.i<data.tasks.length ; v.i++ ){
        v.appendTask(task,'',v.i);
      }
      v.main.appendChild(v.gantt);

      // 第一階層の要素をラッパーに追加
      ['controller','main','dialog'].forEach(x => element.appendChild(v[x]));
      */
    }

    // ブラウザ上で実行する場合の処理
    window.addEventListener('DOMContentLoaded',() => {
      const v = {};

      timetable(document.querySelector('div.timetable[name="tt02"]'),ttData);

      // MarkDownで記述された部分をHTML化して表示
      document.querySelectorAll('script.markdown').forEach(md => {
        v.name = md.getAttribute('name');
        v.content = document.querySelector('script[name="'+v.name+'"]').textContent.trim();
        if( v.m = v.content.match(/^\/\*([\s\S]+)\*\//) )  v.content = v.m[1];
        document.querySelector('div[name="'+v.name+'"]').innerHTML = marked(v.content);
        //console.log(v);
      });

      // PlantUMLで記述された部分をHTML化して表示
      document.querySelectorAll('script.PlantUML').forEach(pu => {
        v.name = pu.getAttribute('name');
        v.content = document.querySelector('script[name="'+v.name+'"]').textContent.trim();
        if( v.m = v.content.match(/^\/\*([\s\S]+)\*\//) )  v.content = v.m[1];
        document.querySelector('.image img[name="'+v.name+'"]').src
        = "http://www.plantuml.com/plantuml/svg/"+plantumlEncoder.encode(v.content);
        //console.log(v);
      });
    });
  </script>
</body></html>