<!DOCTYPE html><html lang="ja">
<head>
  <style type="text/markdown" class="doc">
    <a name="rmIndent"></a>

    ## rmIndent(text) ⇒ <code>string</code> \| <code>Array.&lt;string&gt;</code>
    MarkDownは行頭にスペースがあると正常に処理できないので
    最初に出てきた有効行の行頭スペース分、全ての行から削除する。<br>
    また文頭の長さ0の行は不要なので削除する。

    **Kind**: global function  
    **Returns**: <code>string</code> \| <code>Array.&lt;string&gt;</code> - 行頭スペースが削除された文書  

    | Param | Type | Default | Description |
    | --- | --- | --- | --- |
    | text | <code>string</code> \| <code>Array.&lt;string&gt;</code> | <code>&quot;&#x27;&#x27;&quot;</code> | 処理対象となるテキスト文書 |
  </style>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <meta http-equiv="Content-Script-Type" content="text/javascript">
  <script src="https://taisukef.github.io/marked_md/marked.min.js"></script>
  <title>rmIndent</title>
  <link rel="stylesheet" href="szDefault.css" />
  <style type="text/css" class="source">
    pre {border: solid 5px #999}
  </style>
</head>
<body>

  <div class="source">
    <p>引数サンプル</p>
    <pre name="before"></pre>
    <p>戻り値サンプル</p>
    <pre name="after"></pre>
  </div>
  <div class="source">
    fuga
    <div class="source"> <!-- ←親要素と入れ子 -->
      hoge
    </div>
  </div>
  
  <style type="text/markdown" class="test">
    # はじめに

    ## 本作業の実施時期

    年度初めは低頻度、年度末は高頻度にする。

    - 10,11,12月分 -> 1月頭
    - 1,2,3月分 -> 4月頭
    - 4,5月分 -> 6月頭
    - 6,7月分 -> 8月頭
    - 8月分 -> 9月頭
    - 9月分、その他遺漏分 -> 10月頭

    # 2.1.明細書

    1. 「[MUFG News+](https://www2.cr.mufg.jp/newsplus/amex/?lid=news_amex) > ご請求額・利用明細照会」を開く

        ※ID,PWはGoogle Keepで「MUFGカードWEBサービス」を検索

    1. 保存先に無い利用月の明細をダウンロード

        ```
        保存先：masters > 証憑 > fy20xx > RegExp対応 > yyyyMM.pdf
        ```

        <img id="img01" width="600" />

  </style>
</body>
<script type="text/javascript" class="source">
/** rmIndent: 行頭のスペースを削除する
 * @desc MarkDownは行頭にスペースがあると正常に処理できないので
 * 最初に出てきた有効行の行頭スペース分、全ての行から削除する。<br>
 * また文頭の長さ0の行は不要なので削除する。
 * 
 * @param {string|string[]} text='' - 処理対象となるテキスト文書
 * @returns {string|string[]} 行頭スペースが削除された文書
 */
function rmIndent(text=''){
  console.log('=== rmIndent start');
  const v = {rv:[],
    argtype:typeof text === 'string',  // {boolean} 引数が文字列ならtrue,配列(object)ならfalse
  };
  try {

    if( !text ){
      throw new Error('引数が不適切です');
    }
    v.lines = v.argtype ? text.split('\n') : text;

    for( v.i=0 ; v.i<v.lines.length ; v.i++ ){
      v.m = v.lines[v.i].match(/^([^\S]+)/);
      if( v.m ){
        v.rex = new RegExp('^'+v.m[1]+'(.+)$');
        v.stLine = v.i;
        console.log(v.m[1].length,v.rex);
        break;
      }
    }

    for( v.i=v.stLine ; v.i<v.lines.length ; v.i++ ){
      v.m = v.lines[v.i].match(v.rex);
      v.line = v.m ? v.m[1] : v.lines[v.i];
      v.rv.push(v.line);
      console.log(v.line);
    }

    console.log('=== rmIndent end');
    return v.argtype ? v.rv.join('\n') : v.rv;

  } catch(e){
    alert(e.stack); // ローカルの場合は有効化
    throw e; //以降の処理を全て停止
    //v.rv.stack = e.stack; return v.rv; // 処理継続
  }
}
</script>

<script type="text/javascript" class="test">
function rmIndentTest(){
  const v = {};
  // Markdown文書はstyle/script以外だと内部のタグの部分が取得不可。
  // scriptだと'#'がsyntax errorになるので、styleで囲む。
  document.querySelectorAll('.test[type="text/markdown"]').forEach(o => {
    v.md = o.textContent;
    document.querySelector('pre[name="before"]').innerText = v.md;
    console.log(JSON.stringify(v.md));
    v.rv = rmIndent(v.md);
    document.querySelector('pre[name="after"]').innerText = v.rv;
    console.log(v.rv);
  });
}
</script>

<script type="text/javascript">
  window.addEventListener('DOMContentLoaded',() => {
    const v = {};
    rmIndentTest();

    v.doc = document.createElement('div');
    v.doc.classList.add('sz');

    v.text = document.querySelector('.doc[type="text/markdown"]').textContent;
    v.text = rmIndent(v.text);
    v.md = marked(v.text);
    console.log(v.md)
    v.doc.innerHTML = v.md;
    document.querySelector('body').prepend(v.doc);
  });
</script>
</html>