<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: core.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: core.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @typedef {Object} FileProperties - ファイルの属性情報
 * @property {string} id - ファイルID
 * @property {string} name - ファイル名
 * @property {string} mime - MIMEタイプ
 * @property {string} desc - 説明
 * @property {string} url - ファイルを開くURL
 * @property {string[]} viewers - 閲覧者・コメント投稿者(e-mail)のリスト
 * @property {string[]} editors - 編集者(e-mail)のリスト
 * @property {string} created - ファイルの作成(アップロード)日付。拡張ISO8601形式の文字列
 * @property {string} updated - ファイルの最終更新日付。拡張ISO8601形式の文字列
 */

/** GASutil: GAS 関連のユーティリティ集
 * @namespace GASutil
 * @param {Object} arg={}
 * @param {Object} [arg.db] - SpreadDbへの引数
 * @param {Object} [arg.db.schema] - schema
 * @param {Object} [arg.db.opt] - opt
 */
function GASutil(arg={}) {
  const pv = { whois: 'GASutil', rv: null};

  /** getFileProperties: Fileオブジェクトから属性情報を取得し、FilePropertiesオブジェクトとして返す
   * @memberof GASutil
   * @param {GoogleAppsScript.Drive.File} file - DriveのFileオブジェクト
   * @returns {FileProperties} ファイルの属性情報
   */
  function getFileProperties(file){
    const rv = {
      id: file.getId(), // ID
      name: file.getName(), // ファイル名
      mime: file.getMimeType(),
      desc: file.getDescription(),  // 説明
      url: file.getUrl(), // ファイルを開くURL
      //download : file.getDownloadUrl(),  // ダウンロードに使用するURL
      viewers: [], // {string[]} 閲覧者・コメント投稿者のリスト
      editors: [], // {string[]} 編集者(e-mail)のリスト
      created: toLocale(file.getDateCreated()), // {string} ファイルの作成(アップロード)日付。拡張ISO8601形式の文字列
      updated: toLocale(file.getLastUpdated()), // {string} ファイルの最終更新日付。拡張ISO8601形式の文字列
    };

    // Userからe-mailを抽出
    // class User: https://developers.google.com/apps-script/reference/drive/user?hl=ja
    file.getViewers().forEach(x => rv.viewers.push(x.getEmail()));
    file.getEditors().forEach(x => rv.editors.push(x.getEmail()));
    return rv;
  }

  /** listFiles: 指定フォルダ直下のファイル一覧を取得
   * @memberof GASutil
   * @param {string} [folderId=null] - フォルダID。nullの場合は現在のスプレッドシートが存在するフォルダ
   * @returns {FileProperties[]} ファイル属性情報の配列
   */
  function listFiles(folderId=null) {
    const v = { whois: 'listFiles', rv: [], base: new Date().getTime() };
    // base: 開発用にold.jsonを作成する際、リスト化対象日時を指定(ex. new Date('2025/4/1'))
    dev.start(v.whois, [...arguments]);
    try {

      // -------------------------------------------------------------
      dev.step(1);  // 対象フォルダの特定
      // -------------------------------------------------------------
      if( folderId === null ){
        dev.step(1.1);  // 本スプレッドシートのIDを取得
        v.spread = SpreadsheetApp.getActiveSpreadsheet();
        v.spreadId = v.spread.getId();

        dev.step(1.2);  // 親フォルダおよび直下のファイルを取得
        v.parent = DriveApp.getFileById(v.spreadId).getParents();
        folderId = v.parent.next().getId();
      }

      dev.step(1.3);  // 対象フォルダのFolderオブジェクトを取得
      v.folder = DriveApp.getFolderById(folderId);
      if( v.folder instanceof Error ) throw v.folder;

      dev.step(1.4);  // 対象フォルダ直下のファイルオブジェクトを取得
      v.files = v.folder.getFiles();

      // -------------------------------------------------------------
      dev.step(2);  // ファイルを取得、その属性をオブジェクト化
      // -------------------------------------------------------------
      while (v.files.hasNext()) {
        v.file = v.files.next();
        v.rv.push(getFileProperties(v.file));
      }

      dev.end(); // 終了処理
      return v.rv;

    } catch (e) { dev.error(e); return e; }
  }

  dev.start(pv.whois);
  try {

    dev.step(1);  // SpreadDbを使用する場合、pv.dbとして生成
    if( typeof arg.db !== 'undefined' ){
      if( typeof arg.db.opt === 'undefined' ) arg.db.opt = {};
      pv.db = SpreadDb(arg.db.schema,arg.db.opt);
      if( pv.db instanceof Error ) throw pv.db;
    }

    dev.end(); // 終了処理
    pv.rv = {
      listFiles,
      // overLimit: 最大起動時間を超えた場合、再試行するトリガーを生成
    };
    return pv.rv;

  } catch (e) { dev.error(e); return e; }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="GASutil.html">GASutil</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Thu Sep 18 2025 17:21:18 GMT+0900 (日本標準時)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
